(function(S,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("@designcombo/events")):typeof define=="function"&&define.amd?define(["exports","@designcombo/events"],H):(S=typeof globalThis<"u"?globalThis:S||self,H(S.events={},S.events))})(this,function(S,H){"use strict";var Uo=Object.defineProperty;var Bo=(S,H,Ft)=>H in S?Uo(S,H,{enumerable:!0,configurable:!0,writable:!0,value:Ft}):S[H]=Ft;var Qt=(S,H,Ft)=>Bo(S,typeof H!="symbol"?H+"":H,Ft);var Ft=function(t,r){return Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},Ft(t,r)};function je(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");Ft(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function Rr(t){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cr(t,r){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var n=e.call(t),i,o=[],c;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){c={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(c)throw c.error}}return o}function Pr(t,r,e){if(e||arguments.length===2)for(var n=0,i=r.length,o;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return t.concat(o||Array.prototype.slice.call(r))}typeof SuppressedError=="function"&&SuppressedError;function wt(t){return typeof t=="function"}function Bn(t){var r=function(n){Error.call(n),n.stack=new Error().stack},e=t(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var xr=Bn(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Lr(t,r){if(t){var e=t.indexOf(r);0<=e&&t.splice(e,1)}}var cr=function(){function t(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var r,e,n,i,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=Rr(c),d=u.next();!d.done;d=u.next()){var h=d.value;h.remove(this)}}catch(y){r={error:y}}finally{try{d&&!d.done&&(e=u.return)&&e.call(u)}finally{if(r)throw r.error}}else c.remove(this);var m=this.initialTeardown;if(wt(m))try{m()}catch(y){o=y instanceof xr?y.errors:[y]}var I=this._finalizers;if(I){this._finalizers=null;try{for(var p=Rr(I),k=p.next();!k.done;k=p.next()){var b=k.value;try{Wn(b)}catch(y){o=o??[],y instanceof xr?o=Pr(Pr([],Cr(o)),Cr(y.errors)):o.push(y)}}}catch(y){n={error:y}}finally{try{k&&!k.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new xr(o)}},t.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)Wn(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},t.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},t.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},t.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&Lr(e,r)},t.prototype.remove=function(r){var e=this._finalizers;e&&Lr(e,r),r instanceof t&&r._removeParent(this)},t.EMPTY=function(){var r=new t;return r.closed=!0,r}(),t}(),jn=cr.EMPTY;function Yn(t){return t instanceof cr||t&&"closed"in t&&wt(t.remove)&&wt(t.add)&&wt(t.unsubscribe)}function Wn(t){wt(t)?t():t.unsubscribe()}var Ei={Promise:void 0},Ti={setTimeout:function(t,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];return setTimeout.apply(void 0,Pr([t,r],Cr(e)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function wi(t){Ti.setTimeout(function(){throw t})}function Gn(){}function ur(t){t()}var Xn=function(t){je(r,t);function r(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,Yn(e)&&e.add(n)):n.destination=Oi,n}return r.create=function(e,n,i){return new zr(e,n,i)},r.prototype.next=function(e){this.isStopped||this._next(e)},r.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(cr),Ai=function(){function t(r){this.partialObserver=r}return t.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(n){lr(n)}},t.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(n){lr(n)}else lr(r)},t.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){lr(e)}},t}(),zr=function(t){je(r,t);function r(e,n,i){var o=t.call(this)||this,c;return wt(e)||!e?c={next:e??void 0,error:n??void 0,complete:i??void 0}:c=e,o.destination=new Ai(c),o}return r}(Xn);function lr(t){wi(t)}function Mi(t){throw t}var Oi={closed:!0,next:Gn,error:Mi,complete:Gn},Di=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ri(t){return t}function Ci(t){return t.length===0?Ri:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var Kn=function(){function t(r){r&&(this._subscribe=r)}return t.prototype.lift=function(r){var e=new t;return e.source=this,e.operator=r,e},t.prototype.subscribe=function(r,e,n){var i=this,o=xi(r)?r:new zr(r,e,n);return ur(function(){var c=i,u=c.operator,d=c.source;o.add(u?u.call(o,d):d?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},t.prototype.forEach=function(r,e){var n=this;return e=Vn(e),new e(function(i,o){var c=new zr({next:function(u){try{r(u)}catch(d){o(d),c.unsubscribe()}},error:o,complete:i});n.subscribe(c)})},t.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},t.prototype[Di]=function(){return this},t.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Ci(r)(this)},t.prototype.toPromise=function(r){var e=this;return r=Vn(r),new r(function(n,i){var o;e.subscribe(function(c){return o=c},function(c){return i(c)},function(){return n(o)})})},t.create=function(r){return new t(r)},t}();function Vn(t){var r;return(r=t??Ei.Promise)!==null&&r!==void 0?r:Promise}function Pi(t){return t&&wt(t.next)&&wt(t.error)&&wt(t.complete)}function xi(t){return t&&t instanceof Xn||Pi(t)&&Yn(t)}var Li=Bn(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),qn=function(t){je(r,t);function r(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var n=new Jn(this,this);return n.operator=e,n},r.prototype._throwIfClosed=function(){if(this.closed)throw new Li},r.prototype.next=function(e){var n=this;ur(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var c=Rr(n.currentObservers),u=c.next();!u.done;u=c.next()){var d=u.value;d.next(e)}}catch(h){i={error:h}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}})},r.prototype.error=function(e){var n=this;ur(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var i=n.observers;i.length;)i.shift().error(e)}})},r.prototype.complete=function(){var e=this;ur(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var n=this,i=this,o=i.hasError,c=i.isStopped,u=i.observers;return o||c?jn:(this.currentObservers=null,u.push(e),new cr(function(){n.currentObservers=null,Lr(u,e)}))},r.prototype._checkFinalizedStatuses=function(e){var n=this,i=n.hasError,o=n.thrownError,c=n.isStopped;i?e.error(o):c&&e.complete()},r.prototype.asObservable=function(){var e=new Kn;return e.source=this,e},r.create=function(e,n){return new Jn(e,n)},r}(Kn),Jn=function(t){je(r,t);function r(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return r.prototype.next=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)},r.prototype.error=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)},r.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},r.prototype._subscribe=function(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:jn},r}(qn),Zn=function(t){je(r,t);function r(e){var n=t.call(this)||this;return n._value=e,n}return Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},r.prototype.getValue=function(){var e=this,n=e.hasError,i=e.thrownError,o=e._value;if(n)throw i;return this._throwIfClosed(),o},r.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},r}(qn),ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dr={exports:{}};dr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",i=1,o=2,c=9007199254740991,u="[object Arguments]",d="[object Array]",h="[object AsyncFunction]",m="[object Boolean]",I="[object Date]",p="[object Error]",k="[object Function]",b="[object GeneratorFunction]",y="[object Map]",E="[object Number]",f="[object Null]",_="[object Object]",w="[object Promise]",T="[object Proxy]",M="[object RegExp]",v="[object Set]",A="[object String]",U="[object Symbol]",P="[object Undefined]",K="[object WeakMap]",D="[object ArrayBuffer]",F="[object DataView]",nt="[object Float32Array]",ce="[object Float64Array]",ue="[object Int8Array]",Ae="[object Int16Array]",Me="[object Int32Array]",Oe="[object Uint8Array]",De="[object Uint8ClampedArray]",z="[object Uint16Array]",Re="[object Uint32Array]",Ce=/[\\^$.*+?()[\]{}|]/g,at=/^\[object .+?Constructor\]$/,le=/^(?:0|[1-9]\d*)$/,N={};N[nt]=N[ce]=N[ue]=N[Ae]=N[Me]=N[Oe]=N[De]=N[z]=N[Re]=!0,N[u]=N[d]=N[D]=N[m]=N[F]=N[I]=N[p]=N[k]=N[y]=N[E]=N[_]=N[M]=N[v]=N[A]=N[K]=!1;var de=typeof ht=="object"&&ht&&ht.Object===Object&&ht,Pe=typeof self=="object"&&self&&self.Object===Object&&self,ot=de||Pe||Function("return this")(),fe=r&&!r.nodeType&&r,pe=fe&&!0&&t&&!t.nodeType&&t,Ht=pe&&pe.exports===fe,Ut=Ht&&de.process,he=function(){try{return Ut&&Ut.binding&&Ut.binding("util")}catch{}}(),Bt=he&&he.isTypedArray;function me(s,a){for(var l=-1,g=s==null?0:s.length,R=0,O=[];++l<g;){var L=s[l];a(L,l,s)&&(O[R++]=L)}return O}function jt(s,a){for(var l=-1,g=a.length,R=s.length;++l<g;)s[R+l]=a[l];return s}function ge(s,a){for(var l=-1,g=s==null?0:s.length;++l<g;)if(a(s[l],l,s))return!0;return!1}function xe(s,a){for(var l=-1,g=Array(s);++l<s;)g[l]=a(l);return g}function Le(s){return function(a){return s(a)}}function Mt(s,a){return s.has(a)}function Yt(s,a){return s==null?void 0:s[a]}function Ie(s){var a=-1,l=Array(s.size);return s.forEach(function(g,R){l[++a]=[R,g]}),l}function ye(s,a){return function(l){return s(a(l))}}function pt(s){var a=-1,l=Array(s.size);return s.forEach(function(g){l[++a]=g}),l}var Ot=Array.prototype,ze=Function.prototype,bt=Object.prototype,Dt=ot["__core-js_shared__"],Wt=ze.toString,st=bt.hasOwnProperty,be=function(){var s=/[^.]+$/.exec(Dt&&Dt.keys&&Dt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),_e=bt.toString,Ne=RegExp("^"+Wt.call(st).replace(Ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=Ht?ot.Buffer:void 0,Rt=ot.Symbol,ke=ot.Uint8Array,Ct=bt.propertyIsEnumerable,_t=Ot.splice,ct=Rt?Rt.toStringTag:void 0,Pt=Object.getOwnPropertySymbols,Xt=Gt?Gt.isBuffer:void 0,kt=ye(Object.keys,Object),Kt=Lt(ot,"DataView"),vt=Lt(ot,"Map"),Vt=Lt(ot,"Promise"),qt=Lt(ot,"Set"),tr=Lt(ot,"WeakMap"),Jt=Lt(Object,"create"),yr=it(Kt),xt=it(vt),sn=it(Vt),an=it(qt),on=it(tr),br=Rt?Rt.prototype:void 0,er=br?br.valueOf:void 0;function J(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function cn(){this.__data__=Jt?Jt(null):{},this.size=0}function un(s){var a=this.has(s)&&delete this.__data__[s];return this.size-=a?1:0,a}function ln(s){var a=this.__data__;if(Jt){var l=a[s];return l===n?void 0:l}return st.call(a,s)?a[s]:void 0}function dn(s){var a=this.__data__;return Jt?a[s]!==void 0:st.call(a,s)}function fn(s,a){var l=this.__data__;return this.size+=this.has(s)?0:1,l[s]=Jt&&a===void 0?n:a,this}J.prototype.clear=cn,J.prototype.delete=un,J.prototype.get=ln,J.prototype.has=dn,J.prototype.set=fn;function Q(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function pn(){this.__data__=[],this.size=0}function hn(s){var a=this.__data__,l=He(a,s);if(l<0)return!1;var g=a.length-1;return l==g?a.pop():_t.call(a,l,1),--this.size,!0}function mn(s){var a=this.__data__,l=He(a,s);return l<0?void 0:a[l][1]}function gn(s){return He(this.__data__,s)>-1}function In(s,a){var l=this.__data__,g=He(l,s);return g<0?(++this.size,l.push([s,a])):l[g][1]=a,this}Q.prototype.clear=pn,Q.prototype.delete=hn,Q.prototype.get=mn,Q.prototype.has=gn,Q.prototype.set=In;function ut(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function yn(){this.size=0,this.__data__={hash:new J,map:new(vt||Q),string:new J}}function bn(s){var a=It(this,s).delete(s);return this.size-=a?1:0,a}function _n(s){return It(this,s).get(s)}function kn(s){return It(this,s).has(s)}function vn(s,a){var l=It(this,s),g=l.size;return l.set(s,a),this.size+=l.size==g?0:1,this}ut.prototype.clear=yn,ut.prototype.delete=bn,ut.prototype.get=_n,ut.prototype.has=kn,ut.prototype.set=vn;function Fe(s){var a=-1,l=s==null?0:s.length;for(this.__data__=new ut;++a<l;)this.add(s[a])}function _r(s){return this.__data__.set(s,n),this}function $e(s){return this.__data__.has(s)}Fe.prototype.add=Fe.prototype.push=_r,Fe.prototype.has=$e;function St(s){var a=this.__data__=new Q(s);this.size=a.size}function rr(){this.__data__=new Q,this.size=0}function Sn(s){var a=this.__data__,l=a.delete(s);return this.size=a.size,l}function En(s){return this.__data__.get(s)}function Tn(s){return this.__data__.has(s)}function wn(s,a){var l=this.__data__;if(l instanceof Q){var g=l.__data__;if(!vt||g.length<e-1)return g.push([s,a]),this.size=++l.size,this;l=this.__data__=new ut(g)}return l.set(s,a),this.size=l.size,this}St.prototype.clear=rr,St.prototype.delete=Sn,St.prototype.get=En,St.prototype.has=Tn,St.prototype.set=wn;function An(s,a){var l=Ue(s),g=!l&&Tr(s),R=!l&&!g&&Be(s),O=!l&&!g&&!R&&Mr(s),L=l||g||R||O,x=L?xe(s.length,String):[],j=x.length;for(var $ in s)st.call(s,$)&&!(L&&($=="length"||R&&($=="offset"||$=="parent")||O&&($=="buffer"||$=="byteLength"||$=="byteOffset")||Ln($,j)))&&x.push($);return x}function He(s,a){for(var l=s.length;l--;)if(Er(s[l][0],a))return l;return-1}function nr(s,a,l){var g=a(s);return Ue(s)?g:jt(g,l(s))}function ve(s){return s==null?s===void 0?P:f:ct&&ct in Object(s)?zt(s):Sr(s)}function kr(s){return Tt(s)&&ve(s)==u}function vr(s,a,l,g,R){return s===a?!0:s==null||a==null||!Tt(s)&&!Tt(a)?s!==s&&a!==a:Mn(s,a,l,g,vr,R)}function Mn(s,a,l,g,R,O){var L=Ue(s),x=Ue(a),j=L?d:Et(s),$=x?d:Et(a);j=j==u?_:j,$=$==u?_:$;var tt=j==_,lt=$==_,G=j==$;if(G&&Be(s)){if(!Be(a))return!1;L=!0,tt=!1}if(G&&!tt)return O||(O=new St),L||Mr(s)?sr(s,a,l,g,R,O):Cn(s,a,j,l,g,R,O);if(!(l&i)){var et=tt&&st.call(s,"__wrapped__"),Z=lt&&st.call(a,"__wrapped__");if(et||Z){var Zt=et?s.value():s,Nt=Z?a.value():a;return O||(O=new St),R(Zt,Nt,l,g,O)}}return G?(O||(O=new St),Pn(s,a,l,g,R,O)):!1}function On(s){if(!Ar(s)||Nn(s))return!1;var a=wr(s)?Ne:at;return a.test(it(s))}function Dn(s){return Tt(s)&&ar(s.length)&&!!N[ve(s)]}function Rn(s){if(!Fn(s))return kt(s);var a=[];for(var l in Object(s))st.call(s,l)&&l!="constructor"&&a.push(l);return a}function sr(s,a,l,g,R,O){var L=l&i,x=s.length,j=a.length;if(x!=j&&!(L&&j>x))return!1;var $=O.get(s);if($&&O.get(a))return $==a;var tt=-1,lt=!0,G=l&o?new Fe:void 0;for(O.set(s,a),O.set(a,s);++tt<x;){var et=s[tt],Z=a[tt];if(g)var Zt=L?g(Z,et,tt,a,s,O):g(et,Z,tt,s,a,O);if(Zt!==void 0){if(Zt)continue;lt=!1;break}if(G){if(!ge(a,function(Nt,Ee){if(!Mt(G,Ee)&&(et===Nt||R(et,Nt,l,g,O)))return G.push(Ee)})){lt=!1;break}}else if(!(et===Z||R(et,Z,l,g,O))){lt=!1;break}}return O.delete(s),O.delete(a),lt}function Cn(s,a,l,g,R,O,L){switch(l){case F:if(s.byteLength!=a.byteLength||s.byteOffset!=a.byteOffset)return!1;s=s.buffer,a=a.buffer;case D:return!(s.byteLength!=a.byteLength||!O(new ke(s),new ke(a)));case m:case I:case E:return Er(+s,+a);case p:return s.name==a.name&&s.message==a.message;case M:case A:return s==a+"";case y:var x=Ie;case v:var j=g&i;if(x||(x=pt),s.size!=a.size&&!j)return!1;var $=L.get(s);if($)return $==a;g|=o,L.set(s,a);var tt=sr(x(s),x(a),g,R,O,L);return L.delete(s),tt;case U:if(er)return er.call(s)==er.call(a)}return!1}function Pn(s,a,l,g,R,O){var L=l&i,x=Se(s),j=x.length,$=Se(a),tt=$.length;if(j!=tt&&!L)return!1;for(var lt=j;lt--;){var G=x[lt];if(!(L?G in a:st.call(a,G)))return!1}var et=O.get(s);if(et&&O.get(a))return et==a;var Z=!0;O.set(s,a),O.set(a,s);for(var Zt=L;++lt<j;){G=x[lt];var Nt=s[G],Ee=a[G];if(g)var Si=L?g(Ee,Nt,G,a,s,O):g(Nt,Ee,G,s,a,O);if(!(Si===void 0?Nt===Ee||R(Nt,Ee,l,g,O):Si)){Z=!1;break}Zt||(Zt=G=="constructor")}if(Z&&!Zt){var Or=s.constructor,Dr=a.constructor;Or!=Dr&&"constructor"in s&&"constructor"in a&&!(typeof Or=="function"&&Or instanceof Or&&typeof Dr=="function"&&Dr instanceof Dr)&&(Z=!1)}return O.delete(s),O.delete(a),Z}function Se(s){return nr(s,or,xn)}function It(s,a){var l=s.__data__;return zn(a)?l[typeof a=="string"?"string":"hash"]:l.map}function Lt(s,a){var l=Yt(s,a);return On(l)?l:void 0}function zt(s){var a=st.call(s,ct),l=s[ct];try{s[ct]=void 0;var g=!0}catch{}var R=_e.call(s);return g&&(a?s[ct]=l:delete s[ct]),R}var xn=Pt?function(s){return s==null?[]:(s=Object(s),me(Pt(s),function(a){return Ct.call(s,a)}))}:Hn,Et=ve;(Kt&&Et(new Kt(new ArrayBuffer(1)))!=F||vt&&Et(new vt)!=y||Vt&&Et(Vt.resolve())!=w||qt&&Et(new qt)!=v||tr&&Et(new tr)!=K)&&(Et=function(s){var a=ve(s),l=a==_?s.constructor:void 0,g=l?it(l):"";if(g)switch(g){case yr:return F;case xt:return y;case sn:return w;case an:return v;case on:return K}return a});function Ln(s,a){return a=a??c,!!a&&(typeof s=="number"||le.test(s))&&s>-1&&s%1==0&&s<a}function zn(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function Nn(s){return!!be&&be in s}function Fn(s){var a=s&&s.constructor,l=typeof a=="function"&&a.prototype||bt;return s===l}function Sr(s){return _e.call(s)}function it(s){if(s!=null){try{return Wt.call(s)}catch{}try{return s+""}catch{}}return""}function Er(s,a){return s===a||s!==s&&a!==a}var Tr=kr(function(){return arguments}())?kr:function(s){return Tt(s)&&st.call(s,"callee")&&!Ct.call(s,"callee")},Ue=Array.isArray;function ir(s){return s!=null&&ar(s.length)&&!wr(s)}var Be=Xt||Un;function $n(s,a){return vr(s,a)}function wr(s){if(!Ar(s))return!1;var a=ve(s);return a==k||a==b||a==h||a==T}function ar(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=c}function Ar(s){var a=typeof s;return s!=null&&(a=="object"||a=="function")}function Tt(s){return s!=null&&typeof s=="object"}var Mr=Bt?Le(Bt):Dn;function or(s){return ir(s)?An(s):Rn(s)}function Hn(){return[]}function Un(){return!1}t.exports=$n}(dr,dr.exports);var zi=dr.exports;const Y=Nr(zi),Ni="add",Qn="track",ts="trackItems",Fi=`${Qn}:changed`,$i=`${ts}:changed`,es="state",Hi=`${es}:changed`,rs="bulk",Fr=`${rs}:edit`,fr="design",ns=`${fr}:load`,ss=`${fr}:resize`,B="add",is=`${B}:text`,as=`${B}:video`,os=`${B}:audio`,Ui=`${B}:placeholder`,cs=`${B}:image`,us=`${B}:illustration`,ls=`${B}:shape`,Bi=`${B}:mask`,ji=`${B}:transition`,ds=`${B}:animation`,fs=`${B}:caption`,ps=`${B}:template`,hs=`${B}:items`,ms=`${B}:composition`,gs=`${B}:progressBar`,Is=`${B}:progressFrame`,ys=`${B}:radialAudioBars`,bs=`${B}:linealAudioBars`,_s=`${B}:progressSquare`,ks=`${B}:waveAudioBars`,vs=`${B}:hillAudioBars`,Ss=`${B}:rect`,At="edit",Es=`${At}:object`,Ts=`${At}:replaceMedia`,Yi=`${At}:text`,Wi=`${At}:shape`,Gi=`${At}:templateItem`,Xi=`${At}:deleteTemplateItem`,ws=`${At}:backgroundEditor`,Ki="enterEditMode",te="active",Vi=`${te}:set`,qi=`${te}:delete`,As=`${te}:paste`,Ji=`${te}:clone`,Ms=`${te}:split`,V="layer",Zi=`${V}:locked`,Qi=`${V}:hidden`,ta=`${V}:move`,Os=`${V}:select`,ea=`${V}:selection`,ra=`${V}:sendTo`,na=`${V}:rename`,sa=`${V}:editingName`,Ds=`${V}:copy`,ia=`${V}:paste`,Rs=`${V}:clone`,aa=`${V}:split`,oa=`${V}:cut`,Cs=`${V}:delete`,Ps=`${V}:replace`,Ye="history",xs=`${Ye}:undo`,Ls=`${Ye}:redo`,ca=`${Ye}:reset`,$r="scale",zs=`${$r}:changed`;var pr={exports:{}};pr.exports,function(t,r){var e=200,n="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",c="[object Array]",u="[object Boolean]",d="[object Date]",h="[object Error]",m="[object Function]",I="[object GeneratorFunction]",p="[object Map]",k="[object Number]",b="[object Object]",y="[object Promise]",E="[object RegExp]",f="[object Set]",_="[object String]",w="[object Symbol]",T="[object WeakMap]",M="[object ArrayBuffer]",v="[object DataView]",A="[object Float32Array]",U="[object Float64Array]",P="[object Int8Array]",K="[object Int16Array]",D="[object Int32Array]",F="[object Uint8Array]",nt="[object Uint8ClampedArray]",ce="[object Uint16Array]",ue="[object Uint32Array]",Ae=/[\\^$.*+?()[\]{}|]/g,Me=/\w*$/,Oe=/^\[object .+?Constructor\]$/,De=/^(?:0|[1-9]\d*)$/,z={};z[o]=z[c]=z[M]=z[v]=z[u]=z[d]=z[A]=z[U]=z[P]=z[K]=z[D]=z[p]=z[k]=z[b]=z[E]=z[f]=z[_]=z[w]=z[F]=z[nt]=z[ce]=z[ue]=!0,z[h]=z[m]=z[T]=!1;var Re=typeof ht=="object"&&ht&&ht.Object===Object&&ht,Ce=typeof self=="object"&&self&&self.Object===Object&&self,at=Re||Ce||Function("return this")(),le=r&&!r.nodeType&&r,N=le&&!0&&t&&!t.nodeType&&t,de=N&&N.exports===le;function Pe(s,a){return s.set(a[0],a[1]),s}function ot(s,a){return s.add(a),s}function fe(s,a){for(var l=-1,g=s?s.length:0;++l<g&&a(s[l],l,s)!==!1;);return s}function pe(s,a){for(var l=-1,g=a.length,R=s.length;++l<g;)s[R+l]=a[l];return s}function Ht(s,a,l,g){for(var R=-1,O=s?s.length:0;++R<O;)l=a(l,s[R],R,s);return l}function Ut(s,a){for(var l=-1,g=Array(s);++l<s;)g[l]=a(l);return g}function he(s,a){return s==null?void 0:s[a]}function Bt(s){var a=!1;if(s!=null&&typeof s.toString!="function")try{a=!!(s+"")}catch{}return a}function me(s){var a=-1,l=Array(s.size);return s.forEach(function(g,R){l[++a]=[R,g]}),l}function jt(s,a){return function(l){return s(a(l))}}function ge(s){var a=-1,l=Array(s.size);return s.forEach(function(g){l[++a]=g}),l}var xe=Array.prototype,Le=Function.prototype,Mt=Object.prototype,Yt=at["__core-js_shared__"],Ie=function(){var s=/[^.]+$/.exec(Yt&&Yt.keys&&Yt.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),ye=Le.toString,pt=Mt.hasOwnProperty,Ot=Mt.toString,ze=RegExp("^"+ye.call(pt).replace(Ae,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bt=de?at.Buffer:void 0,Dt=at.Symbol,Wt=at.Uint8Array,st=jt(Object.getPrototypeOf,Object),be=Object.create,_e=Mt.propertyIsEnumerable,Ne=xe.splice,Gt=Object.getOwnPropertySymbols,Rt=bt?bt.isBuffer:void 0,ke=jt(Object.keys,Object),Ct=It(at,"DataView"),_t=It(at,"Map"),ct=It(at,"Promise"),Pt=It(at,"Set"),Xt=It(at,"WeakMap"),kt=It(Object,"create"),Kt=it(Ct),vt=it(_t),Vt=it(ct),qt=it(Pt),tr=it(Xt),Jt=Dt?Dt.prototype:void 0,yr=Jt?Jt.valueOf:void 0;function xt(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function sn(){this.__data__=kt?kt(null):{}}function an(s){return this.has(s)&&delete this.__data__[s]}function on(s){var a=this.__data__;if(kt){var l=a[s];return l===n?void 0:l}return pt.call(a,s)?a[s]:void 0}function br(s){var a=this.__data__;return kt?a[s]!==void 0:pt.call(a,s)}function er(s,a){var l=this.__data__;return l[s]=kt&&a===void 0?n:a,this}xt.prototype.clear=sn,xt.prototype.delete=an,xt.prototype.get=on,xt.prototype.has=br,xt.prototype.set=er;function J(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function cn(){this.__data__=[]}function un(s){var a=this.__data__,l=$e(a,s);if(l<0)return!1;var g=a.length-1;return l==g?a.pop():Ne.call(a,l,1),!0}function ln(s){var a=this.__data__,l=$e(a,s);return l<0?void 0:a[l][1]}function dn(s){return $e(this.__data__,s)>-1}function fn(s,a){var l=this.__data__,g=$e(l,s);return g<0?l.push([s,a]):l[g][1]=a,this}J.prototype.clear=cn,J.prototype.delete=un,J.prototype.get=ln,J.prototype.has=dn,J.prototype.set=fn;function Q(s){var a=-1,l=s?s.length:0;for(this.clear();++a<l;){var g=s[a];this.set(g[0],g[1])}}function pn(){this.__data__={hash:new xt,map:new(_t||J),string:new xt}}function hn(s){return Se(this,s).delete(s)}function mn(s){return Se(this,s).get(s)}function gn(s){return Se(this,s).has(s)}function In(s,a){return Se(this,s).set(s,a),this}Q.prototype.clear=pn,Q.prototype.delete=hn,Q.prototype.get=mn,Q.prototype.has=gn,Q.prototype.set=In;function ut(s){this.__data__=new J(s)}function yn(){this.__data__=new J}function bn(s){return this.__data__.delete(s)}function _n(s){return this.__data__.get(s)}function kn(s){return this.__data__.has(s)}function vn(s,a){var l=this.__data__;if(l instanceof J){var g=l.__data__;if(!_t||g.length<e-1)return g.push([s,a]),this;l=this.__data__=new Q(g)}return l.set(s,a),this}ut.prototype.clear=yn,ut.prototype.delete=bn,ut.prototype.get=_n,ut.prototype.has=kn,ut.prototype.set=vn;function Fe(s,a){var l=ir(s)||Ue(s)?Ut(s.length,String):[],g=l.length,R=!!g;for(var O in s)pt.call(s,O)&&!(R&&(O=="length"||zn(O,g)))&&l.push(O);return l}function _r(s,a,l){var g=s[a];(!(pt.call(s,a)&&Tr(g,l))||l===void 0&&!(a in s))&&(s[a]=l)}function $e(s,a){for(var l=s.length;l--;)if(Tr(s[l][0],a))return l;return-1}function St(s,a){return s&&sr(a,or(a),s)}function rr(s,a,l,g,R,O,L){var x;if(g&&(x=O?g(s,R,O,L):g(s)),x!==void 0)return x;if(!Tt(s))return s;var j=ir(s);if(j){if(x=xn(s),!a)return Rn(s,x)}else{var $=zt(s),tt=$==m||$==I;if(wr(s))return He(s,a);if($==b||$==o||tt&&!O){if(Bt(s))return O?s:{};if(x=Et(tt?{}:s),!a)return Cn(s,St(x,s))}else{if(!z[$])return O?s:{};x=Ln(s,$,rr,a)}}L||(L=new ut);var lt=L.get(s);if(lt)return lt;if(L.set(s,x),!j)var G=l?Pn(s):or(s);return fe(G||s,function(et,Z){G&&(Z=et,et=s[Z]),_r(x,Z,rr(et,a,l,g,Z,s,L))}),x}function Sn(s){return Tt(s)?be(s):{}}function En(s,a,l){var g=a(s);return ir(s)?g:pe(g,l(s))}function Tn(s){return Ot.call(s)}function wn(s){if(!Tt(s)||Fn(s))return!1;var a=ar(s)||Bt(s)?ze:Oe;return a.test(it(s))}function An(s){if(!Sr(s))return ke(s);var a=[];for(var l in Object(s))pt.call(s,l)&&l!="constructor"&&a.push(l);return a}function He(s,a){if(a)return s.slice();var l=new s.constructor(s.length);return s.copy(l),l}function nr(s){var a=new s.constructor(s.byteLength);return new Wt(a).set(new Wt(s)),a}function ve(s,a){var l=a?nr(s.buffer):s.buffer;return new s.constructor(l,s.byteOffset,s.byteLength)}function kr(s,a,l){var g=a?l(me(s),!0):me(s);return Ht(g,Pe,new s.constructor)}function vr(s){var a=new s.constructor(s.source,Me.exec(s));return a.lastIndex=s.lastIndex,a}function Mn(s,a,l){var g=a?l(ge(s),!0):ge(s);return Ht(g,ot,new s.constructor)}function On(s){return yr?Object(yr.call(s)):{}}function Dn(s,a){var l=a?nr(s.buffer):s.buffer;return new s.constructor(l,s.byteOffset,s.length)}function Rn(s,a){var l=-1,g=s.length;for(a||(a=Array(g));++l<g;)a[l]=s[l];return a}function sr(s,a,l,g){l||(l={});for(var R=-1,O=a.length;++R<O;){var L=a[R],x=void 0;_r(l,L,x===void 0?s[L]:x)}return l}function Cn(s,a){return sr(s,Lt(s),a)}function Pn(s){return En(s,or,Lt)}function Se(s,a){var l=s.__data__;return Nn(a)?l[typeof a=="string"?"string":"hash"]:l.map}function It(s,a){var l=he(s,a);return wn(l)?l:void 0}var Lt=Gt?jt(Gt,Object):Hn,zt=Tn;(Ct&&zt(new Ct(new ArrayBuffer(1)))!=v||_t&&zt(new _t)!=p||ct&&zt(ct.resolve())!=y||Pt&&zt(new Pt)!=f||Xt&&zt(new Xt)!=T)&&(zt=function(s){var a=Ot.call(s),l=a==b?s.constructor:void 0,g=l?it(l):void 0;if(g)switch(g){case Kt:return v;case vt:return p;case Vt:return y;case qt:return f;case tr:return T}return a});function xn(s){var a=s.length,l=s.constructor(a);return a&&typeof s[0]=="string"&&pt.call(s,"index")&&(l.index=s.index,l.input=s.input),l}function Et(s){return typeof s.constructor=="function"&&!Sr(s)?Sn(st(s)):{}}function Ln(s,a,l,g){var R=s.constructor;switch(a){case M:return nr(s);case u:case d:return new R(+s);case v:return ve(s,g);case A:case U:case P:case K:case D:case F:case nt:case ce:case ue:return Dn(s,g);case p:return kr(s,g,l);case k:case _:return new R(s);case E:return vr(s);case f:return Mn(s,g,l);case w:return On(s)}}function zn(s,a){return a=a??i,!!a&&(typeof s=="number"||De.test(s))&&s>-1&&s%1==0&&s<a}function Nn(s){var a=typeof s;return a=="string"||a=="number"||a=="symbol"||a=="boolean"?s!=="__proto__":s===null}function Fn(s){return!!Ie&&Ie in s}function Sr(s){var a=s&&s.constructor,l=typeof a=="function"&&a.prototype||Mt;return s===l}function it(s){if(s!=null){try{return ye.call(s)}catch{}try{return s+""}catch{}}return""}function Er(s){return rr(s,!0,!0)}function Tr(s,a){return s===a||s!==s&&a!==a}function Ue(s){return $n(s)&&pt.call(s,"callee")&&(!_e.call(s,"callee")||Ot.call(s)==o)}var ir=Array.isArray;function Be(s){return s!=null&&Ar(s.length)&&!ar(s)}function $n(s){return Mr(s)&&Be(s)}var wr=Rt||Un;function ar(s){var a=Tt(s)?Ot.call(s):"";return a==m||a==I}function Ar(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=i}function Tt(s){var a=typeof s;return!!s&&(a=="object"||a=="function")}function Mr(s){return!!s&&typeof s=="object"}function or(s){return Be(s)?Fe(s):An(s)}function Hn(){return[]}function Un(){return!1}t.exports=Er}(pr,pr.exports);var ua=pr.exports;const C=Nr(ua);function la(t,r){return t.filter(n=>{if(r.forEach(i=>{n.items.includes(i)&&(n.items=n.items.filter(o=>o!==i))}),n.items.length!==0||n.static)return n})}const X=t=>Object.keys(t).reduce((r,e)=>{const{display:n}=t[e];return Math.max(r,n.to)},0);function rt(t,r,e){t.forEach(n=>{const i=Object.values(r).filter(p=>n.items.includes(p.id)),c=i.filter(p=>!e.includes(p.id)).sort((p,k)=>p.display.from-k.display.from),u=c[c.length-1];let d=(u==null?void 0:u.display.to)||0;i.forEach(p=>{if(e.includes(p.id)){const k=p.display.to-p.display.from;p.display={from:d,to:d+k},d=d+k}});const m=i.sort((p,k)=>p.display.from-k.display.from).map(p=>p.id);let I=0;m.forEach(p=>{const k=[];let b=0;if(k.forEach(y=>{y.forEach(E=>{E.type==="transition"&&(b+=E.duration)})}),r[p]){const y=r[p].display.to-r[p].display.from;r[p].display={from:I-b,to:I+y-b},I+=y}})})}function Ns(t,r,e,n,i,o){return r.forEach(c=>{if(!t.includes(c)&&(i[c]=e[c],e[c].type==="composition"||e[c].type==="template")){const u=n.find(d=>d.id===c);u&&(o.push(u),Ns(t,u.items,e,n,i,o))}}),{updatedTrackItems:i,updatedStructure:o}}function da(t,r){const e=C(t),n=r&&r.length?r:e.activeIds,i=n.map(v=>e.trackItemsMap[v]).filter(v=>!!v).map(v=>v.id),o=e.transitionIds.filter(v=>{const A=e.transitionsMap[v];return i.includes(A.fromId)||i.includes(A.toId)});i.push(...o);const c=e.trackItemIds,u=e.transitionIds,d=C(e.tracks),h=C(e.structure);i.forEach(v=>{var U;const A=e.trackItemsMap[v]||e.transitionsMap[v];if(A.type==="template"||A.type==="composition"){const P=(U=e.structure.find(D=>D.id===A.id))==null?void 0:U.items;i.push(...P);const K=h.findIndex(D=>D.id===A.id);h.splice(K,1)}}),i.forEach(v=>{h.forEach(A=>{A.items.includes(v)&&(A.items=A.items.filter(U=>U!==v))})});const m=c.filter(v=>!i.includes(v));u.forEach(v=>{n.includes(v)&&n.length===1&&C(e.transitionsMap[v])});const I=u.filter(v=>!i.includes(v)&&!n.includes(v)),p=Object.fromEntries(Object.entries(e.transitionsMap).filter(([v])=>!i.includes(v)));Object.keys(p).forEach(v=>{n.includes(v)&&(p[v].kind="none")});const k=e.trackItemIds.filter(v=>!n.includes(v)),b=la(e.tracks,n),y=Object.fromEntries(Object.entries(e.trackItemsMap).filter(([v])=>!i.includes(v))),E=d.filter(v=>v.magnetic);rt(E,y,[]);const f={},_=[],{updatedTrackItems:w,updatedStructure:T}=Ns(i,k,e.trackItemsMap,e.structure,f,_),M=X(w);return{trackItemIds:m,activeIds:[],trackItemsMap:w,tracks:b,duration:M,structure:T,transitionIds:I,transitionsMap:p}}const fa="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Fs=(t=21)=>{let r="",e=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)r+=fa[e[t]&63];return r};function ee(t=16){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=r.charAt(Math.floor(Math.random()*r.length));let n=Fs(t-1);return n=n.replace(/[^a-zA-Z0-9]/g,"").slice(0,t-1),e+n}const Te=t=>{const r=t.map(e=>new FontFace(e.fontFamily,`url(${e.url})`).load().catch(n=>n));return r.length===0?Promise.resolve(!0):new Promise((e,n)=>{Promise.all(r).then(i=>{i.forEach(o=>{o&&o.family&&(document.fonts.add(o),e(!0))})}).catch(i=>n(i))})};function pa(t,r){return t.forEach(e=>{r=r.split(e).join(ee())}),r}function $s(t,r,e){const n=t.find(o=>o.id===r);if(!n)return[];const i=n.items;return i.forEach(o=>{const c=e[o];(c.type==="text"||c.type==="caption")&&Te([{fontFamily:c.details.fontFamily,url:c.details.fontUrl}]),(c.type==="composition"||c.type==="template")&&i.push(...$s(t,o,e))}),i}async function ha(t){let r=localStorage.getItem("DesignComboTemp");if(!r)return{};const e=C(t);let n=C(JSON.parse(r));const i=n.activeIds,o=n.trackItemsMap,c=n.structure;Object.keys(o).forEach(y=>{const E=o[y];if((E.type==="text"||E.type==="caption")&&Te([{fontFamily:E.details.fontFamily,url:E.details.fontUrl}]),E.type==="composition"||E.type==="template"){const f=$s(c,y,o);i.push(...f)}});const u=pa(i,r),d=C(JSON.parse(u)),h=e.tracks;d.activeIds.forEach(y=>{const E=d.trackItemsMap[y];e.trackItemsMap[y]=E,e.trackItemIds.push(y);const f={id:ee(),type:E.type,items:[y],magnetic:!1,static:!1};h.unshift(f)});const m=[...d.structure,...e.structure],I=e.trackItemIds,p={...d.trackItemsMap,...e.trackItemsMap},k={structure:m,trackItemIds:I,trackItemsMap:p,tracks:h},b=X(k.trackItemsMap);return{trackItemIds:k.trackItemIds,trackItemsMap:k.trackItemsMap,structure:k.structure,tracks:k.tracks,duration:b}}let hr={cors:{audio:!0,video:!0,image:!0},acceptsMap:{text:["text","caption","composition"],image:["image","video"],video:["video","image"],audio:["audio"],composition:["composition"],caption:["caption","text","composition"],template:["template","image","video"],customTrack:["video","image","template"],customTrack2:["video","image","template"],illustration:["illustration","custom"],custom:["custom","video","illustration"],main:["video","image","template"],shape:["shape","custom","illustration"],linealAudioBars:["audio","linealAudioBars"],radialAudioBars:["audio","radialAudioBars"],progressFrame:["audio","progressFrame"],progressBar:["audio","progressBar"],rect:["rect"],progressSquare:["progressSquare"]}};const ma=t=>{const r=Object.fromEntries(Object.entries(t).filter(([e,n])=>n!==void 0));hr={...hr,...r}},Hr=()=>hr.cors,Hs=()=>hr.acceptsMap,we=t=>new Promise((r,e)=>{const n=new Image;n.onload=()=>{const o=n.width,c=n.height;r({width:o,height:c})},n.onerror=o=>{e(o)},Hr().image&&(n.crossOrigin="anonymous"),n.src=t}),Us=t=>new Promise((r,e)=>{const n=new Audio;n.preload="auto",n.addEventListener("loadedmetadata",()=>{const o=n.duration*1e3;r({duration:o})}),n.addEventListener("error",o=>{e(o)}),n.src=t,Hr().audio&&(n.crossOrigin="anonymous"),n.load()}),Ur=t=>new Promise((r,e)=>{const n=document.createElement("video");n.preload="auto",n.addEventListener("loadedmetadata",()=>{const o=n.duration*1e3,c=n.videoWidth,u=n.videoHeight;r({duration:o,width:c,height:u})}),n.addEventListener("error",o=>{e(o)}),n.src=t,Hr().video&&(n.crossOrigin="anonymous"),n.load()}),ga=async t=>{var i,o;const r=t.duration,e=(i=t.details)==null?void 0:i.width,n=(o=t.details)==null?void 0:o.height;return r&&e&&n?{duration:r,width:e,height:n}:Ur(t.details.src)},Bs=(t,r)=>{const e=document.createElement("div");Object.keys(r).forEach(i=>{i!=="height"&&(e.style[i]=r[i])}),document.body.appendChild(e),e.textContent=t,e.style.whiteSpace="normal",e.style.position="absolute",e.style.visibility="hidden",e.style.display="inline-block",e.style.width=r.width+"px",e.style.fontSize=r.fontSize+"px";const n=getComputedStyle(e).height;return document.body.removeChild(e),parseFloat(n)},js=(t,r)=>{var u,d;const e=((u=t.details.crop)==null?void 0:u.width)||t.details.width||0,n=((d=t.details.crop)==null?void 0:d.height)||t.details.height||0;let i=r.width,o=r.height;const c=r.width/r.height;return e/n>c?(i=e,o=e/c):(o=n,i=n*c),{newWidth:i,newHeight:o,crop:{x:0,y:0,height:n,width:e}}},Ys=(t,r)=>{const e=C(t.trim),n=C(t.display);return r.duration<t.display.to&&(n.to=r.duration,e&&(e.to=r.duration)),{duration:r.duration,trim:e,display:n}};async function Ia(t,r){const e={...t},n=Object.keys(r)[0],i=Object.values(r)[0],o=e.trackItemsMap[n],c={...e.trackItemsMap[n]},u=o.details;if(!i.details.src)return{};if(o.type==="image"){const d=await we(i.details.src),{crop:h,newHeight:m,newWidth:I}=js(o,d);i.details.crop=h,i.details.height=m,i.details.width=I}else if(o.type==="video"){const d=await Ur(i.details.src),h=e.trackItemsMap[n],{display:m,duration:I,trim:p}=Ys(h,d),{crop:k,newHeight:b,newWidth:y}=js(o,d);i.details.crop=k,i.details.height=b,i.details.width=y,c.display=m,c.duration=I,c.trim=p}else if(o.type==="audio"){const d=await Us(i.details.src),h=e.trackItemsMap[n],{display:m,duration:I,trim:p}=Ys(h,d);c.display=m,c.duration=I,c.trim=p}return o.details={...u,...i.details},e.trackItemsMap[n]={...c},{trackItemsMap:{...e.trackItemsMap,[n]:{...c,details:{...u,...i.details}}}}}function ya(t,r){const e=C(t),n={},i=r&&r.length?r:e.activeIds;if(i.length===0)return{};i.forEach(c=>{const u=e.trackItemsMap[c],d=ee();e.trackItemsMap[d]={...C(u),id:d},e.trackItemIds.push(d);const h=e.tracks.find(m=>m.items.includes(c));n[h.id]?n[h.id].items.push(d):n[h.id]={...h,id:ee(),items:[d],static:!1,magnetic:!1}});const o=Object.values(n);return e.tracks=[...o,...e.tracks],{trackItemsMap:e.trackItemsMap,tracks:e.tracks,trackItemIds:e.trackItemIds}}function ba(t){const r=/#([0-9a-fA-F]{3,6})\b/g,e=/rgb\(\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/g,n=/rgba\(\s*(\d+),\s*(\d+),\s*(\d+),\s*([0-9.]+)\s*\)/g;function i(c){return c.length===3?`#${c[0]}${c[0]}${c[1]}${c[1]}${c[2]}${c[2]}`.toUpperCase():`#${c.toUpperCase()}`}function o(c,u,d){return`#${(1<<24|c<<16|u<<8|d).toString(16).slice(1).toUpperCase()}`}return t=t.replace(r,(c,u)=>i(u)),t=t.replace(e,(c,u,d,h)=>o(+u,+d,+h)),t=t.replace(n,(c,u,d,h)=>o(+u,+d,+h)),t}function q(t){return/^#[0-9a-fA-F]{3}$/.test(t)?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:t}function Ws(t,r){let e=t;for(const n in r)if(Object.prototype.hasOwnProperty.call(r,n)){const i=new RegExp(n,"g");e=e.replace(i,r[n])}return e}function Gs(t){const r=t.getAttribute("fill");if(r&&r.trim()!==""&&r.trim()!=="none")return r.trim();const e=t.getAttribute("style");if(e){const i=/fill\s*:\s*([^;]+);?/.exec(e);if(i){const o=i[1].trim();if(o!==""&&o!=="none")return o}}const n=t.parentElement;return n?Gs(n):null}function We(t){return/^#([0-9A-Fa-f]{3}|[0-9A-Fa-f]{6})$/.test(t)}const _a=t=>{const r=`.${t.split(".").filter(o=>o.includes("fill:")).join(".")}`,e={},n=/\.([\w-]+)\s*\{\s*([^}]+)\s*\}/g;let i;for(;(i=n.exec(r))!==null;){const o=i[1],c=i[2],u={},d=/fill\s*:\s*([^;]+);?/.exec(c),h=/stroke\s*:\s*([^;]+);?/.exec(c);d&&(u.fill=q(d[1].trim())),h&&(u.stroke=q(h[1].trim())),e[o]=u}return e};function Br(t){let r=t.parentElement;for(;r;){if(r.tagName.toLowerCase()==="mask")return!0;r=r.parentElement}return!1}function ka(t,r,e=300,n=300){const i=[],c=new DOMParser().parseFromString(t,"image/svg+xml"),u=c.documentElement;u.setAttribute("width",`${e}`),u.setAttribute("height",`${n}`);const d=u.querySelectorAll("style"),h={};d.forEach(y=>{const E=y.textContent||"",f=_a(E);Object.assign(h,f);const _=E.replace(/\.(st[\w-]+)/g,`.${r}-$1`).replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`);y.textContent=_;const w=Array.from(c.querySelectorAll("*")),T=new Set;w.forEach(M=>{if(Br(M))return;["fill","stroke","stop-color"].forEach(U=>{const P=M.getAttribute(U);P&&!["none","transparent"].includes(P)&&T.add(q(P))});const v=M.getAttribute("style");if(v){const U=/fill\s*:\s*([^;]+);?/.exec(v),P=/stroke\s*:\s*([^;]+);?/.exec(v),K=/stop-color\s*:\s*([^;]+);?/.exec(v);if(U){const D=U[1].trim();D&&!["none","transparent"].includes(D)&&We(q(D))&&T.add(q(D))}if(P){const D=P[1].trim();D&&!["none","transparent"].includes(D)&&We(q(D))&&T.add(q(D))}if(K){const D=K[1].trim();D&&!["none","transparent"].includes(D)&&We(q(D))&&T.add(q(D))}}const A=M.getAttribute("class");A&&A.split(" ").forEach(U=>{const P=h[U];P!=null&&P.fill&&!["none","transparent"].includes(P.fill)&&T.add(q(P.fill)),P!=null&&P.stroke&&!["none","transparent"].includes(P.stroke)&&T.add(q(P.stroke))})}),Array.from(T).forEach(M=>{We(M)&&i.push(M)})});const m=Array.from(c.querySelectorAll("*")),I=new Set;return m.forEach(y=>{if(Br(y))return;const E=y.getAttribute("class");if(E){const _=E.split(" ").map(w=>`${r}-${w}`).join(" ");y.setAttribute("class",_),_.split(" ").forEach(w=>{const T=h[w];T!=null&&T.fill&&!["none","transparent"].includes(T.fill)&&I.add(q(T.fill)),T!=null&&T.stroke&&!["none","transparent"].includes(T.stroke)&&I.add(q(T.stroke))})}["fill","stroke","stop-color"].forEach(_=>{const w=y.getAttribute(_);w&&!["none","transparent"].includes(w)&&I.add(q(w))});const f=y.getAttribute("style");if(f){const _=/fill\s*:\s*([^;]+);?/.exec(f),w=/stroke\s*:\s*([^;]+);?/.exec(f),T=/stop-color\s*:\s*([^;]+);?/.exec(f);if(_){const M=_[1].trim();M&&!["none","transparent"].includes(M)&&I.add(q(M))}if(w){const M=w[1].trim();M&&!["none","transparent"].includes(M)&&I.add(q(M))}if(T){const M=T[1].trim();M&&!["none","transparent"].includes(M)&&I.add(q(M))}}}),I.forEach(y=>!i.includes(y)&&We(y)&&i.push(y)),Array.from(c.querySelectorAll("*")).forEach(y=>{if(y.hasAttribute("id")){const E=y.getAttribute("id");y.setAttribute("id",`${r}-${E}`)}if(["fill","stroke","stop-color","filter","clip-path","mask"].forEach(E=>{const f=y.getAttribute(E);f&&f.includes("url(#")&&y.setAttribute(E,f.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}),y.hasAttribute("style")){const E=y.getAttribute("style");E.includes("url(#")&&y.setAttribute("style",E.replace(/url\(#(.*?)\)/g,`url(#${r}-$1)`))}}),Array.from(c.querySelectorAll("path")).forEach(y=>{if(Br(y))return;!Gs(y)&&!y.getAttribute("class")&&(y.setAttribute("fill","#000000"),i.includes("#000000")||i.push("#000000"))}),{serializer:new XMLSerializer().serializeToString(c),colors:i}}const Ge={color:"#000000",x:0,y:0,blur:0},mt=(t,r)=>{let e=r!=null&&r.trim?r.trim.to-r.trim.from:(r==null?void 0:r.duration)||5e3;const n={from:0,to:e};if(!t)return n;if(t.from<0)return console.error("'from' must be a non-negative number. Returning default display."),n;if(t.from!==void 0&&t.to===void 0)return{from:t.from,to:t.from+e};if(t.to!==void 0){if(t.to<0)return console.error("'to' must be a non-negative number. Returning default display."),n;if(t.to<t.from)return console.error("'to' must be greater than or equal to 'from'. Returning default display."),n}return t},Xs=(t,r)=>t?t.from&&!t.to?{from:t.from,to:r.duration}:t:{from:0,to:r.duration};function Ks(t,r){const e={x:t.size.width/2,y:t.size.height/2},n={x:r.width/2,y:r.height/2},i=e.x-n.x;return{top:`${e.y-n.y}px`,left:`${i}px`,transform:"none"}}function gt(t,r){const e=t.scaleMode,n={x:t.size.width/2,y:t.size.height/2},i={x:r.width/2,y:r.height/2};let o;if(e==="fill")o=Math.max(t.size.width/r.width,t.size.height/r.height);else if(e==="fit"){const d=t.scaleAspectRatio||1;o=Math.min(t.size.width/r.width,t.size.height/r.height)*d}else o=Math.min(t.size.width/r.width,t.size.height/r.height);const c=n.x-i.x;return{top:`${n.y-i.y}px`,left:`${c}px`,transform:`scale(${o})`}}const Vs=async(t,r)=>{const e=t.details.src,n=await ga(t),i=gt(r,{...n}),o=Xs(t.trim,{duration:n.duration}),c={width:n.width,height:n.height,opacity:100,src:e,volume:t.details.volume??100,borderRadius:t.details.borderRadius??0,borderWidth:t.details.borderWidth??0,borderColor:t.details.borderColor||"#000000",boxShadow:t.details.boxShadow||Ge,top:t.details.top||i.top||"0px",left:t.details.left||i.left||"0px",transform:t.details.transform||i.transform,blur:t.details.blur||0,brightness:t.details.brightness||100,flipX:t.details.flipX||!1,flipY:t.details.flipY||!1,rotate:t.details.rotate||"0deg",visibility:t.details.visibility||"visible"};return{...t,trim:o,type:"video",name:"video",details:c,playbackRate:t.playbackRate||1,display:mt(t.display,{duration:n.duration,trim:o}),duration:n.duration}},qs=async t=>{const r=t.id,e=t.details,i=(await Us(e.src)).duration,o=Xs(t.trim,{duration:i});return{id:r,name:t.name||"audio",type:"audio",display:mt(t.display,{duration:i,trim:o}),trim:o,playbackRate:t.playbackRate||1,details:{src:e.src,volume:e.volume??100},metadata:{...t.metadata},duration:i}},va=async(t,r)=>{var u,d;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},i=t.details,o=gt(r,n),c=mt(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,backgroundColors:(i==null?void 0:i.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"]},metadata:{}}},Sa=async(t,r)=>{var u,d;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},i=t.details,o=gt(r,n),c=mt(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,backgroundColors:(i==null?void 0:i.backgroundColors)||["rgba(128, 128, 128,0.5)","rgba(128, 128, 128,1)"],barThickness:i.barThickness||10},metadata:{}}},Ea=async(t,r)=>{var u,d;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},i=t.details,o=gt(r,n),c=mt(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,radialBarColor:i.radialBarColor||"rgba(128, 128, 128,1)",border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1},metadata:{}}},Ta=async(t,r)=>{var u,d;const e=t.id,n={width:((u=t.details)==null?void 0:u.width)||r.size.width,height:((d=t.details)==null?void 0:d.height)||r.size.height},i=t.details,o=gt(r,n),c=mt(t.display);return{id:e,name:t.type,type:t.type,display:c,details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,strokeColors:(i==null?void 0:i.strokeColors)||["#ff9800","#ff5722"],strokeWidth:(i==null?void 0:i.strokeWidth)||100,strokeBackground:(i==null?void 0:i.strokeBackground)||"#fff",flipX:(i==null?void 0:i.flipX)||!1,flipY:(i==null?void 0:i.flipY)||!1,rotate:(i==null?void 0:i.rotate)||"0deg",transform:(i==null?void 0:i.transform)||"none"},metadata:{}}},jr=async(t,r)=>{var c,u;const e=t.id,n={width:((c=t.details)==null?void 0:c.width)||r.size.width,height:((u=t.details)==null?void 0:u.height)||r.size.height},i=t.details,o=gt(r,n);return{id:e,name:t.type,type:t.type,display:{from:0,to:t.duration||1e4},details:{width:(i==null?void 0:i.width)||n.width,height:(i==null?void 0:i.height)||n.height,top:(i==null?void 0:i.top)||o.top,left:(i==null?void 0:i.left)||o.left,border:i.border||"none",borderRadius:i.borderRadius||0,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",opacity:i.opacity||100,flipX:i.flipX||!1,flipY:i.flipY||!1,inverted:i.inverted||!1,linealBarColor:i.linealBarColor||"rgba(128, 128, 128,1)",lineThickness:i.lineThickness||1,gapSize:i.gapSize||1,roundness:i.roundness||1,placement:i.placement||null,strokeColor:i.strokeColor||"#92E1B0",fillColor:i.fillColor||null,strokeWidth:i.strokeWidth||null,copies:i.copies||null,offsetPixelSpeed:i.offsetPixelSpeed||0,lineColor:i.lineColor||"#92E1B0",lineGap:i.lineGap||0,topRoundness:i.topRoundness||0,bottomRoundness:i.bottomRoundness||0,lines:i.lines||0,sections:i.sections||0},metadata:{}}},Js=async(t,r)=>{var I;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},i=Math.min(r.size.width/n.width,r.size.height/n.height),o=((I=t.details)==null?void 0:I.rotate)||0,c=gt(r,n),u=t.display;let d=1/0,h=0;e.forEach(p=>{const k=t.trackItemsMap[p];k.display.from<d&&(d=k.display.from),k.display.to>h&&(h=k.display.to)});const m=t.trim||t.display||{from:d,to:h};return{id:t.id,type:"template",details:{...n,transform:t.details.transform||c.transform,top:t.details.top||c.top,left:t.details.left||c.left,scale:i,rotate:o,background:t.details.background||"transparent"},trim:m,display:u||{from:d,to:h},activeEdit:!1}},wa=async(t,r)=>{var m;const e=t.trackItemIds,n=t.size||{width:t.details.width,height:t.details.height},i=Math.min(r.size.width/n.width,r.size.height/n.height),o=((m=t.details)==null?void 0:m.rotate)||0,c=gt(r,n),u=t.display;let d=1/0,h=0;return e.forEach(I=>{const p=t.trackItemsMap[I];p.display.from<d&&(d=p.display.from),p.display.to>h&&(h=p.display.to)}),{id:t.id,type:"composition",details:{...n,transform:t.details.transform||c.transform,top:t.details.top||c.top,left:t.details.left||c.left,scale:i,rotate:o},display:u||{from:d,to:h}}},Zs=async(t,r)=>{const e=t.details,n=we(e.src),i=fetch(e.src),[o,c]=await Promise.all([n,i]),u=await c.text(),d=gt(r,o),{serializer:h,colors:m}=ka(ba(u),t.id,Number(e.width||o.width),Number(e.height||o.height)),I=t.details.colorMap||Object.fromEntries(m.map(p=>[p,p]));return{id:t.id,name:"illustration",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||o.width||100,height:e.height||o.height||100,opacity:e.opacity??100,transform:e.transform||d.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||d.top||"0px",left:e.left||d.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",svgString:h,initialSvgString:C(h),colorMap:I},metadata:t.metadata||{}}},Aa=async(t,r)=>{const e=t.details,n=we(e.src),[i]=await Promise.all([n]),o=gt(r,i);return{id:t.id,name:"shape",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||i.width||100,height:e.height||i.height||100,opacity:e.opacity??100,transform:e.transform||o.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||o.top||"0px",left:e.left||o.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080"},metadata:t.metadata||{}}},Ma=async(t,r)=>{const e=t.details,n=gt(r,{width:e.width,height:e.height});return{id:t.id,name:"rect",type:t.type,display:mt(t.display),playbackRate:t.playbackRate||1,details:{width:e.width||100,height:e.height||100,opacity:e.opacity??100,transform:e.transform||n.transform,border:e.border||"none",borderRadius:e.borderRadius||0,top:e.top||n.top||"0px",left:e.left||n.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible",backgroundColor:e.backgroundColor||"#808080",boxShadow:e.boxShadow||Ge,blur:e.blur||0,brightness:e.brightness||100},metadata:t.metadata||{}}},Qs=async(t,r)=>{const e=t.details,n=await we(e.src),i=gt(r,n);return{id:t.id,type:"image",name:"image",display:mt(t.display),playbackRate:t.playbackRate||1,details:{src:e.src||"",width:e.width||n.width||100,height:e.height||n.height||100,opacity:e.opacity??100,transform:e.transform||i.transform,border:e.border||"none",borderRadius:e.borderRadius||0,boxShadow:e.boxShadow||Ge,top:e.top||i.top||"0px",left:e.left||i.left||"0px",borderWidth:e.borderWidth??0,borderColor:e.borderColor||"#000000",blur:e.blur||0,brightness:e.brightness||100,flipX:e.flipX||!1,flipY:e.flipY||!1,rotate:e.rotate||"0deg",visibility:e.visibility||"visible"},metadata:t.metadata||{}}},ti=async(t,r)=>{const e=t;e.details.fontUrl&&await Te([{fontFamily:e.details.fontFamily,url:e.details.fontUrl}]);const n=e.id,i=e.details,o=ri(i),c=i.height||Bs(e.details.text,o),u=i.top!=null&&i.left!=null?{top:`${i.top}px`,left:`${i.left}px`}:Ks(r,{width:o.width,height:c});return{id:n,name:"caption",type:"caption",display:mt(e.display),details:{...e.details,...o,text:i.text||"",height:c,fontUrl:i.fontUrl,top:o.top||u.top,left:o.left||u.left,borderWidth:i.borderWidth||0,borderColor:i.borderColor||"#000000",boxShadow:i.boxShadow||Ge,words:i.words||[],appearedColor:i.appearedColor||i.color,activeColor:i.activeColor||i.color,activeFillColor:i.activeFillColor||"transparent",isKeywordColor:i.isKeywordColor||"transparent",preservedColorKeyWord:i.preservedColorKeyWord||!1,linesPerCaption:i.linesPerCaption||2,wordsPerLine:i.wordsPerLine||"punctuationOrPause"},metadata:t.metadata||{}}},ei=async(t,r)=>{t.details.fontUrl&&await Te([{fontFamily:t.details.fontFamily,url:t.details.fontUrl}]);const e=t.id,n=t.details,i=ri(n),o=n.height||Bs(t.details.text,i),c=n.top!=null&&n.left!=null?{top:`${n.top}px`,left:`${n.left}px`}:Ks(r,{width:i.width,height:o});return{id:e,name:"text",type:"text",display:mt(t.display),details:{...t.details,...i,text:n.text||"",height:o,fontUrl:n.fontUrl,top:i.top||c.top,left:i.left||c.left,borderWidth:n.borderWidth||0,borderColor:n.borderColor||"#000000",boxShadow:n.boxShadow||Ge},metadata:{}}},ri=t=>({fontFamily:t.fontFamily||"Arial",fontSize:t.fontSize||"16px",fontWeight:t.fontWeight||"normal",fontStyle:t.fontStyle||"normal",textDecoration:t.textDecoration||"none",textAlign:t.textAlign||"left",lineHeight:t.lineHeight||"normal",letterSpacing:t.letterSpacing||"normal",wordSpacing:t.wordSpacing||"normal",color:t.color||"#ffffff",backgroundColor:t.backgroundColor||"transparent",border:t.border||"none",textShadow:t.textShadow||"none",text:t.text||"",opacity:t.opacity??100,width:t.width||300,wordWrap:t.wordWrap||"normal",wordBreak:t.wordBreak||"normal",WebkitTextStrokeColor:t.WebkitTextStrokeColor||"#ffffff",WebkitTextStrokeWidth:t.WebkitTextStrokeWidth||"0px",top:t.top,left:t.left,textTransform:t.textTransform||"none",transform:t.transform||"none",skewX:t.skewX||0,skewY:t.skewY||0}),Oa=async(t,r)=>{switch(t.type){case"video":return Vs(t,r||{});case"audio":return qs(t);case"image":return Qs(t,r||{});case"text":return ei(t,r||{});case"caption":return ti(t,r||{});case"template":return Js(t,{size:r==null?void 0:r.size});default:throw new Error("Unsupported track item")}};function ni(t,r){return r.some(e=>t.some(n=>n.id===e.id))}const si=(t=[],r=[])=>t.length===0?r.map(n=>({id:ee(),items:[n.id],type:n.type,accepts:["text","image","video","audio","caption","template"]})):t.map(e=>({...e,items:e.items||[],accepts:["audio","video","image","text","caption","template"],type:e.type||"text",magnetic:e.magnetic||!1,static:e.static||!1,id:e.id||ee()}));async function Da(t,r){var c,u,d;const e=r.trackItemsMap,n=new Set,i=new Map;for(const h in e){const m=e[h];if(m.type==="text"||m.type==="caption"){if(m.details.fontUrl){const I={fontFamily:m.details.fontFamily,url:m.details.fontUrl};n.add(JSON.stringify(I))}(c=m.animations)!=null&&c.in&&m.animations.in.composition.forEach(I=>{var p;(p=I.details)!=null&&p.fonts&&I.details.fonts.forEach(k=>{n.add(JSON.stringify(k))})}),(u=m.animations)!=null&&u.loop&&m.animations.loop.composition.forEach(I=>{var p;(p=I.details)!=null&&p.fonts&&I.details.fonts.forEach(k=>{n.add(JSON.stringify(k))})}),(d=m.animations)!=null&&d.out&&m.animations.out.composition.forEach(I=>{var p;(p=I.details)!=null&&p.fonts&&I.details.fonts.forEach(k=>{n.add(JSON.stringify(k))})})}else m.type==="illustration"&&i.set(h,{trackItem:m,details:m.details})}n.size>0&&await Te(Array.from(n).map(h=>JSON.parse(h)));for(const[h,m]of i){const I=await Zs({...m.trackItem,details:m.details},{size:{width:m.details.width,height:m.details.height}}),p=Ws(I.details.svgString,m.details.colorMap);I.details.svgString=p,e[h]=I}const o=X(e);return{...r,duration:o}}function Ra(t){const r=C(t);if(!r.activeIds.length)return;const e=r.activeIds,n=[],i={activeIds:e,trackItemsMap:{},tracks:[],structure:[]};e.forEach(d=>{i.trackItemsMap[d]=r.trackItemsMap[d],n.push(r.tracks.find(h=>h.items.includes(d)))});const o=new Set;n.filter(d=>o.has(d.id)?!1:(o.add(d.id),!0)),i.tracks=Array.from(o),i.activeIds.forEach(d=>{if(i.trackItemsMap[d].type==="composition"||i.trackItemsMap[d].type==="template"){const h=r.structure.find(m=>m.id===d);h&&(i.structure.push(h),h.items.forEach(m=>{i.trackItemsMap[m]=r.trackItemsMap[m]}))}});let u=JSON.stringify(i);localStorage.setItem("DesignComboTemp",u)}function Ca(t,r){const e=C(t);if(e.activeIds.length!==1)return{};const n=e.activeIds[0],i=C(e.trackItemsMap[n]);if(r>=i.display.to||r<=i.display.from)return{};const o=ee(),c={...i,display:{from:i.display.from,to:r}},u={...i,id:o,display:{from:r,to:i.display.to}},d=Object.values(e.transitionsMap).find(m=>m.fromId===i.id&&m.kind!=="none"),h=Object.values(e.transitionsMap).find(m=>m.toId===i.id&&m.kind!=="none");if(i.type==="video"||i.type==="audio"){const m=r-c.display.from;c.trim={from:i.trim.from,to:i.trim.from+m},u.trim={from:i.trim.from+m,to:i.trim.to}}if(h){const m=c.display.to-c.display.from;if(h.duration/2>m){e.transitionIds=e.transitionIds.filter(p=>p!==h.id);const I={};e.transitionIds.forEach(p=>I[p]=e.transitionsMap[p]),e.transitionsMap=I}}if(d){const m=u.display.to-u.display.from,I={};d.duration/2>m?(e.transitionIds=e.transitionIds.filter(p=>p!==d.id),e.transitionIds.forEach(p=>I[p]=e.transitionsMap[p]),e.transitionsMap=I):(e.transitionIds=e.transitionIds.map(p=>e.transitionsMap[p].fromId===c.id?p.replace(c.id,o):p),Object.keys(e.transitionsMap).forEach(p=>{if(e.transitionsMap[p].fromId===c.id){const b=p.replace(c.id,o);I[b]={...e.transitionsMap[p],id:b,fromId:o}}else I[p]=e.transitionsMap[p]}),e.transitionsMap=I)}return e.trackItemsMap[n]=c,e.trackItemsMap[o]=u,e.trackItemIds.push(o),e.tracks.forEach(m=>{m.items.includes(n)&&m.items.push(o)}),{tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionsMap:e.transitionsMap,transitionIds:e.transitionIds}}async function Pa(t,r){const n=C(t).trackItemsMap,i=Object.keys(r);if(!i.length)return{};for(const c of i){const u=r[c];if(u.details&&(n[c].details={...n[c].details,...u.details},u.details.colorMap)){const d=n[c].details.initialSvgString,h=Ws(d,u.details.colorMap);n[c].details.svgString=h}if(u.metadata&&(n[c].metadata?n[c].metadata={...n[c].metadata,...u.metadata}:n[c].metadata=u.metadata),u.display||u.playbackRate){const d=u.playbackRate,h=n[c].playbackRate||1,m=n[c].display,k=(m.to-m.from)*h/d,b={from:m.from,to:m.from+k};n[c].display=b,n[c].playbackRate=d}u.animations&&(n[c].animations={...n[c].animations,...u.animations})}for(const c of i){const u=r[c];if(n[c].type==="shape"&&u.details.src){const d=await we(u.details.src);n[c].details.width=d.width,n[c].details.height=d.height}}const o=X(n);return{trackItemsMap:{...n},duration:o}}async function xa(t,r){const e=C(t),n=Object.keys(r)[0],i=Object.values(r)[0],o=e.trackItemsMap[n],c=o.details;if(!i.details.src)return{};if(o.type==="image"){const u=await we(i.details.src),d=o.details.width||0,h=o.details.height||0;let m=u.width,I=u.height;const p=u.width/u.height;d/h>p?(m=d,I=d/p):(I=h,m=h*p),c.crop={x:0,y:0,height:c.height,width:c.width},i.details.width=m,i.details.height=I}else if(o.type==="video"){const u=await Ur(i.details.src),d=o.details.width||0,h=o.details.height||0;let m=u.width,I=u.height;const p=u.width/u.height;d/h>p?(m=d,I=d/p):(I=h,m=h*p),c.crop={x:0,y:0,height:c.height,width:c.width},i.details.width=m,i.details.height=I}return i.details&&(o.details={...c,...i.details},i.details=o.details),e.trackItemsMap[n]={...e.trackItemsMap[n],type:i.type},{trackItemsMap:{...e.trackItemsMap}}}function La(t,r){const e=C(t);return e.background.value=r.value,e.background.type=r.type||"color",{...e}}function za(t,{idTrack:r,idItems:e},n){const i=n.tracks.find(c=>c.id===r);if(!i)return;const o=i.items.reduce((c,u)=>{const d=n.trackItemsMap[u];return d.display.to>c.display.to?d:c},t[0]);e.forEach(c=>{const u=t.find(h=>h.id===c);if(!u)return;const d=u.display.to-u.display.from;u.display.from=o.display.to,u.display.to=u.display.from+d})}async function Na(t,r,e={}){var k;const n=C(t),i=r.trackItems.map(b=>Oa(b,{size:n.size})),o=await Promise.all(i);(k=r.tracks)==null||k.forEach(b=>{za(o,{idTrack:b.id,idItems:b.items},n)});const c=si(r.tracks,r.trackItems),u=[],d=o.map(b=>b.id);r.trackItems.forEach(b=>{if(b.type!=="template")return;n.trackItemsMap={...n.trackItemsMap,...b.trackItemsMap},n.transitionsMap={...n.transitionsMap,...b.transitionsMap};const y={id:b.id,items:b.trackItemIds,transitions:b.transitionsIds||[],tracks:b.tracks};u.push(y)});const h=[],m={};if(o.forEach(b=>{h.push(b.id),m[b.id]=b}),ni(n.tracks,c))n.tracks.forEach(b=>{c.forEach(y=>{b.id===y.id&&(b.magnetic&&rt([b],n.trackItemsMap,d),b.items.push(...h))})});else{const b=e.trackIndex||0,y=Math.min(Math.max(b,0),n.tracks.length);n.tracks.splice(y,0,...c)}n.trackItemsMap={...n.trackItemsMap,...m},n.trackItemIds=[...n.trackItemIds,...h],n.structure=[...n.structure,...u];const p=n.tracks.filter(b=>b.magnetic);return rt(p,n.trackItemsMap,d),n.duration=X(n.trackItemsMap),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration,structure:n.structure,transitionIds:n.transitionIds,transitionsMap:n.transitionsMap}}function yt(t,r,e={isNewTrack:!0}){const n=r.map(c=>c.id),i=[],o={};if(r.forEach(c=>{i.push(c.id),o[c.id]=c}),(e.targetTrackIndex!==void 0||e.targetTrackId)&&!e.isNewTrack){const c=e.targetTrackIndex||0,u=e.targetTrackId;let d=t.tracks[c];if(u&&(d=t.tracks.find(h=>h.id===u)),!d)throw new Error("Target track not found");d.items.push(...i)}else{const c={id:Fs(),accepts:Object.keys(Hs()),type:r[0].type,items:n,magnetic:!1,static:!1};t.tracks.splice(e.targetTrackIndex||0,0,c)}return t.trackItemsMap={...t.trackItemsMap,...o},t.trackItemIds=[...t.trackItemIds,...i],t}async function Fa(t,r,e={}){const n=C(t),i=[Qs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e),d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),u.duration=X(u.trackItemsMap),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function $a(t,r,e={}){const n=C(t),i=[qs(r)],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Ha(t,r,e={}){const n=C(t),i=[Vs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Ua(t,r,e={}){const n=C(t),i=[ei(r,{size:e.size})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Ba(t,r,e={}){const n=C(t),i=[Aa(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function ja(t,r,e={}){const n=C(t),i=[Zs(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}async function Ya(t,r,e={}){const n=C(t),i="composition",o=r.trackItemsMap,c=r.trackItemIds,u=r.tracks||[],d=r.trackItemDetailsMap,{details:h,...m}=await wa(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),I={id:m.id,items:c,transitions:[],tracks:u},k=[{...m,type:i,details:h}],b=yt(n,k,e);b.trackItemsMap={...b.trackItemsMap,...o,[m.id]:{...m,type:i,details:h}},b.structure=[...b.structure,I],b.duration=X(b.trackItemsMap);const y=b.tracks.filter(E=>E.magnetic);return rt(y,b.trackItemsMap,[m.id]),d&&Object.keys(d).forEach(E=>{b.trackItemsMap[E]={...b.trackItemsMap[E],details:{...d[E].details}}}),{trackItemIds:b.trackItemIds,trackItemsMap:b.trackItemsMap,tracks:b.tracks,duration:b.duration,structure:b.structure}}async function re(t,r,e={},n){const i=C(t),o=I=>I.display?I.display:{from:0,to:i.duration},c=[];n==="progress-bar"&&c.push(va(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="progress-frame"&&c.push(Sa(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})),n==="radial-audio-bars"&&(r.display=o(r),c.push(Ea(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="lineal-audio-bars"&&(r.display=o(r),c.push(jr(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="wave-audio-bars"&&(r.display=o(r),c.push(jr(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="hill-audio-bars"&&(r.display=o(r),c.push(jr(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}))),n==="progress-square"&&c.push(Ta(r,{size:i.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}));const u=await Promise.all(c),d=u.map(I=>I.id),h=yt(i,u,e);h.duration=X(h.trackItemsMap);const m=h.tracks.filter(I=>I.magnetic);return rt(m,h.trackItemsMap,d),{trackItemIds:h.trackItemIds,trackItemsMap:h.trackItemsMap,tracks:h.tracks,duration:h.duration}}async function Wa(t,r,e={}){const n=C(t),i="template",o=r.trackItemsMap,c=r.trackItemIds,u=r.transitionsMap,d=r.transitionIds||[],h=r.tracks||[],m=r.structure||[],{details:I,...p}=await Js(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio}),k={id:p.id,items:c,transitions:d,tracks:h},y=[{...p,type:i,details:I}],E=yt(n,y,e);E.transitionIds=[...E.transitionIds,...d],E.transitionsMap={...E.transitionsMap,...u},E.trackItemsMap={...E.trackItemsMap,...o,[p.id]:{...p,type:i,details:I}},E.structure=[...E.structure,k,...m],E.duration=X(E.trackItemsMap);const f=E.tracks.filter(_=>_.magnetic);return rt(f,E.trackItemsMap,[p.id]),{trackItemIds:E.trackItemIds,trackItemsMap:E.trackItemsMap,tracks:E.tracks,duration:E.duration,structure:E.structure,transitionsMap:E.transitionsMap}}async function Ga(t,r,e={}){const n=C(t),i=r.trackItems.map(I=>ti(I,{size:e.size})),o=await Promise.all(i),c=si(r.tracks,r.trackItems),u=[],d={};if(o.forEach(I=>{const{details:p,...k}=I;u.push(I.id),d[I.id]=k}),ni(n.tracks,c))n.tracks.forEach(I=>{c.forEach(p=>{I.id===p.id&&(I.magnetic&&rt([I],n.trackItemsMap,u),I.items.push(...u))})});else{const I=e.trackIndex||0,p=Math.min(Math.max(I,0),n.tracks.length);n.tracks.splice(p,0,...c)}n.trackItemsMap={...n.trackItemsMap,...d},n.trackItemIds=[...n.trackItemIds,...u],n.duration=X(n.trackItemsMap);const m=n.tracks.filter(I=>I.magnetic);return rt(m,n.trackItemsMap,u),{trackItemIds:n.trackItemIds,trackItemsMap:n.trackItemsMap,tracks:n.tracks,duration:n.duration}}async function Xa(t,r){const e=C(t),n=e.trackItemsMap[r.id],i=[];if(!n)return{};let o=n.animations||{};return r.animations.loop?r.animations.loop.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}):r.animations.in?r.animations.in.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}):r.animations.out?r.animations.out.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}):r.animations.timed&&r.animations.timed.composition.forEach(c=>{var u;(u=c.details)!=null&&u.fonts&&i.push(...c.details.fonts)}),i.length>0&&await Te(i),o.in&&r.animations.in?o.in=r.animations.in:o.out&&r.animations.out?o.out=r.animations.out:o.loop&&r.animations.loop?o.loop=r.animations.loop:!o.out&&r.animations.out?o.out=r.animations.out:!o.in&&r.animations.in?o.in=r.animations.in:!o.loop&&r.animations.loop?o.loop=r.animations.loop:o=r.animations,(r.animations.in||r.animations.out||r.animations.loop)&&delete o.timed,r.animations.timed&&(o.timed=r.animations.timed,delete o.in,delete o.out,delete o.loop),n.animations=o,{trackItemsMap:e.trackItemsMap}}async function Ka(t,r,e={}){const n=C(t),i=[Ma(r,{size:n.size,scaleMode:e.scaleMode,scaleAspectRatio:e.scaleAspectRatio})],o=await Promise.all(i),c=o.map(h=>h.id),u=yt(n,o,e);u.duration=X(u.trackItemsMap);const d=u.tracks.filter(h=>h.magnetic);return rt(d,u.trackItemsMap,c),{trackItemIds:u.trackItemIds,trackItemsMap:u.trackItemsMap,tracks:u.tracks,duration:u.duration}}function Va(t){const r=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Fr))),e=H.subject.pipe(H.filter(({key:f})=>f.startsWith(fr))),n=H.subject.pipe(H.filter(({key:f})=>f.startsWith(B))),i=H.subject.pipe(H.filter(({key:f})=>f.startsWith(V))),o=H.subject.pipe(H.filter(({key:f})=>f.startsWith(Ye))),c=H.subject.pipe(H.filter(({key:f})=>f.startsWith(te))),u=H.subject.pipe(H.filter(({key:f})=>f.startsWith(At))),d=H.subject.pipe(H.filter(({key:f})=>f.startsWith($r))),h=r.subscribe(async f=>{var _;if(f.key===Fr){const{actions:w}=(_=f.value)==null?void 0:_.payload;w.forEach(T=>{H.dispatch(T.type,T.payload&&{payload:T.payload})})}}),m=e.subscribe(async f=>{var _,w;if(f.key===ns){const T=(_=f.value)==null?void 0:_.payload,M=await Da(t.getState(),T);t.updateState(M,{kind:"design:load",updateHistory:!1})}if(f.key===ss){const T=(w=f.value)==null?void 0:w.payload;t.updateState({size:T},{kind:"design:resize",updateHistory:!1})}}),I=o.subscribe(f=>{if(f.key===xs)return t.undo();if(f.key===Ls)return t.redo()}),p=d.subscribe(f=>{var _;if(f.key===zs){const w=(_=f.value)==null?void 0:_.payload.scale;t.updateState({scale:w},{kind:"update",updateHistory:!1})}}),k=i.subscribe(async f=>{var _,w,T,M;if(f.key===Os){const v=((_=f.value)==null?void 0:_.payload.trackItemIds)||[];t.updateState({activeIds:v},{kind:"update",updateHistory:!1})}if(f.key===Ds&&Ra(t.getState()),f.key===Cs){const v=(w=f.value)==null?void 0:w.payload.trackItemIds,A=da(t.getState(),v);t.updateState(A,{updateHistory:!0,kind:"remove"})}if(f.key===Rs){const v=ya(t.getState(),(T=f.value)==null?void 0:T.payload.trackItemIds);t.updateState(v,{updateHistory:!0,kind:"update"})}if(f.key===Ps){const v=(M=f.value)==null?void 0:M.payload,A=await Ia(t.getState(),v);t.updateState(A,{updateHistory:!0,kind:"update:details"})}}),b=n.subscribe(async f=>{var U,P,K,D,F,nt,ce,ue,Ae,Me,Oe,De,z,Re,Ce,at,le,N,de,Pe,ot,fe,pe,Ht,Ut,he,Bt,me,jt,ge,xe,Le,Mt,Yt,Ie,ye,pt,Ot,ze,bt,Dt,Wt,st,be,_e,Ne,Gt,Rt,ke,Ct,_t,ct,Pt,Xt,kt,Kt,vt,Vt,qt;const _=C(t.getState()),w=((P=(U=f.value)==null?void 0:U.options)==null?void 0:P.isSelected)||!1,T=(D=(K=f.value)==null?void 0:K.options)==null?void 0:D.scaleMode,M=(nt=(F=f.value)==null?void 0:F.options)==null?void 0:nt.scaleAspectRatio,v=(ue=(ce=f.value)==null?void 0:ce.options)==null?void 0:ue.trackIndex;let A={};f.key===ds?A=await Xa(_,(Ae=f.value)==null?void 0:Ae.payload):f.key===hs?A=await Na(_,(Me=f.value)==null?void 0:Me.payload,{trackIndex:v}):f.key===fs?A=await Ga(_,(Oe=f.value)==null?void 0:Oe.payload,{trackIndex:v}):f.key===is?A=await Ua(_,(De=f.value)==null?void 0:De.payload,{targetTrackIndex:v,targetTrackId:(z=f.value)==null?void 0:z.options.targetTrackId,size:_.size,isNewTrack:(Ce=(Re=f.value)==null?void 0:Re.options)==null?void 0:Ce.isNewTrack}):f.key===ps?A=await Wa(_,(at=f.value)==null?void 0:at.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(N=(le=f.value)==null?void 0:le.options)==null?void 0:N.targetTrackId}):f.key===us?A=await ja(_,(de=f.value)==null?void 0:de.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Pe=f.value)==null?void 0:Pe.options.targetTrackId}):f.key===ls?A=await Ba(_,(ot=f.value)==null?void 0:ot.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(fe=f.value)==null?void 0:fe.options.targetTrackId}):f.key===Ss?A=await Ka(_,(pe=f.value)==null?void 0:pe.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Ht=f.value)==null?void 0:Ht.options.targetTrackId}):f.key===cs?A=await Fa(_,(Ut=f.value)==null?void 0:Ut.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(he=f.value)==null?void 0:he.options.targetTrackId,isNewTrack:(me=(Bt=f.value)==null?void 0:Bt.options)==null?void 0:me.isNewTrack}):f.key===os?A=await $a(_,(jt=f.value)==null?void 0:jt.payload,{targetTrackIndex:v,targetTrackId:(ge=f.value)==null?void 0:ge.options.targetTrackId,isNewTrack:(Le=(xe=f.value)==null?void 0:xe.options)==null?void 0:Le.isNewTrack}):f.key===as?A=await Ha(_,(Mt=f.value)==null?void 0:Mt.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Yt=f.value)==null?void 0:Yt.options.targetTrackId,isNewTrack:(ye=(Ie=f.value)==null?void 0:Ie.options)==null?void 0:ye.isNewTrack}):f.key===ms?A=await Ya(_,(pt=f.value)==null?void 0:pt.payload,{scaleMode:T,scaleAspectRatio:M,targetTrackIndex:v,targetTrackId:(Ot=f.value)==null?void 0:Ot.options.targetTrackId}):f.key===gs?A=await re(_,(ze=f.value)==null?void 0:ze.payload,{targetTrackIndex:v,targetTrackId:(Dt=(bt=f.value)==null?void 0:bt.options)==null?void 0:Dt.targetTrackId},"progress-bar"):f.key===_s?A=await re(_,(Wt=f.value)==null?void 0:Wt.payload,{targetTrackIndex:v,targetTrackId:(be=(st=f.value)==null?void 0:st.options)==null?void 0:be.targetTrackId},"progress-square"):f.key===Is?A=await re(_,(_e=f.value)==null?void 0:_e.payload,{targetTrackIndex:v,targetTrackId:(Gt=(Ne=f.value)==null?void 0:Ne.options)==null?void 0:Gt.targetTrackId},"progress-frame"):f.key===ys?A=await re(_,(Rt=f.value)==null?void 0:Rt.payload,{targetTrackIndex:v,targetTrackId:(Ct=(ke=f.value)==null?void 0:ke.options)==null?void 0:Ct.targetTrackId},"radial-audio-bars"):f.key===bs?A=await re(_,(_t=f.value)==null?void 0:_t.payload,{targetTrackIndex:v,targetTrackId:(Pt=(ct=f.value)==null?void 0:ct.options)==null?void 0:Pt.targetTrackId},"lineal-audio-bars"):f.key===ks?A=await re(_,(Xt=f.value)==null?void 0:Xt.payload,{targetTrackIndex:v,targetTrackId:(Kt=(kt=f.value)==null?void 0:kt.options)==null?void 0:Kt.targetTrackId},"wave-audio-bars"):f.key===vs&&(A=await re(_,(vt=f.value)==null?void 0:vt.payload,{targetTrackIndex:v,targetTrackId:(qt=(Vt=f.value)==null?void 0:Vt.options)==null?void 0:qt.targetTrackId},"hill-audio-bars")),w&&A.trackItemIds&&(A.activeIds=A.trackItemIds),t.updateState(A,{updateHistory:!0,kind:"add"})}),y=c.subscribe(async f=>{var _;if(f.key===Ms){const w=(_=f.value)==null?void 0:_.options.time,T=Ca(t.getState(),w);Object.keys(T).length>0&&t.updateState(T,{updateHistory:!0,kind:"update"})}if(f.key===As){const w=await ha(t.getState());t.updateState(w,{updateHistory:!0,kind:"update"})}}),E=u.subscribe(async f=>{var _,w,T;if(f.key===Es){const M=await Pa(t.getState(),(_=f.value)==null?void 0:_.payload);t.updateState(M,{updateHistory:!0,kind:"update:details"})}if(f.key===Ts){const M=await xa(t.getState(),(w=f.value)==null?void 0:w.payload);t.updateState(M,{updateHistory:!0,kind:"update:details"})}if(f.key===ws){const M=La(t.getState(),(T=f.value)==null?void 0:T.payload);t.updateState(M,{updateHistory:!0,kind:"update:details"})}});return{unsubscribe:()=>{b.unsubscribe(),y.unsubscribe(),E.unsubscribe(),I.unsubscribe(),k.unsubscribe(),m.unsubscribe(),p.unsubscribe(),h.unsubscribe()}}}const qa={Date:!0,RegExp:!0,String:!0,Number:!0};function ii(t,r,e={cyclesFix:!0},n=[]){var u,d;let i=[];const o=Array.isArray(t);for(const h in t){const m=t[h],I=o?+h:h;if(!(h in r)){i.push({type:"REMOVE",path:[I],oldValue:t[h]});continue}const p=r[h],k=typeof m=="object"&&typeof p=="object"&&Array.isArray(m)===Array.isArray(p);m&&p&&k&&!qa[(d=(u=Object.getPrototypeOf(m))==null?void 0:u.constructor)==null?void 0:d.name]&&(!e.cyclesFix||!n.includes(m))?i.push.apply(i,ii(m,p,e,e.cyclesFix?n.concat([m]):[]).map(b=>(b.path.unshift(I),b))):m!==p&&!(Number.isNaN(m)&&Number.isNaN(p))&&!(k&&(isNaN(m)?m+""==p+"":+m==+p))&&i.push({path:[I],type:"CHANGE",value:p,oldValue:m})}const c=Array.isArray(r);for(const h in r)h in t||i.push({type:"CREATE",path:[c?+h:h],value:r[h]});return i}var Yr=Symbol.for("immer-nothing"),Xe=Symbol.for("immer-draftable"),dt=Symbol.for("immer-state"),ai=process.env.NODE_ENV!=="production"?[function(t){return`The plugin for '${t}' has not been loaded into Immer. To enable the plugin, import and call \`enable${t}()\` when initializing your application.`},function(t){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${t}'`},"This object has been frozen and should not be mutated",function(t){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+t},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(t){return`'current' expects a draft, got: ${t}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(t){return`'original' expects a draft, got: ${t}`}]:[];function W(t,...r){if(process.env.NODE_ENV!=="production"){const e=ai[t],n=typeof e=="function"?e.apply(null,r):e;throw new Error(`[Immer] ${n}`)}throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var ne=Object.getPrototypeOf;function se(t){return!!t&&!!t[dt]}function $t(t){var r;return t?oi(t)||Array.isArray(t)||!!t[Xe]||!!((r=t.constructor)!=null&&r[Xe])||qe(t)||Je(t):!1}var Ja=Object.prototype.constructor.toString();function oi(t){if(!t||typeof t!="object")return!1;const r=ne(t);if(r===null)return!0;const e=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return e===Object?!0:typeof e=="function"&&Function.toString.call(e)===Ja}function Ke(t,r){ie(t)===0?Reflect.ownKeys(t).forEach(e=>{r(e,t[e],t)}):t.forEach((e,n)=>r(n,e,t))}function ie(t){const r=t[dt];return r?r.type_:Array.isArray(t)?1:qe(t)?2:Je(t)?3:0}function Ve(t,r){return ie(t)===2?t.has(r):Object.prototype.hasOwnProperty.call(t,r)}function Wr(t,r){return ie(t)===2?t.get(r):t[r]}function ci(t,r,e){const n=ie(t);n===2?t.set(r,e):n===3?t.add(e):t[r]=e}function Za(t,r){return t===r?t!==0||1/t===1/r:t!==t&&r!==r}function qe(t){return t instanceof Map}function Je(t){return t instanceof Set}function ae(t){return t.copy_||t.base_}function Gr(t,r){if(qe(t))return new Map(t);if(Je(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const e=oi(t);if(r===!0||r==="class_only"&&!e){const n=Object.getOwnPropertyDescriptors(t);delete n[dt];let i=Reflect.ownKeys(n);for(let o=0;o<i.length;o++){const c=i[o],u=n[c];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[c]={configurable:!0,writable:!0,enumerable:u.enumerable,value:t[c]})}return Object.create(ne(t),n)}else{const n=ne(t);if(n!==null&&e)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function Xr(t,r=!1){return mr(t)||se(t)||!$t(t)||(ie(t)>1&&(t.set=t.add=t.clear=t.delete=Qa),Object.freeze(t),r&&Object.entries(t).forEach(([e,n])=>Xr(n,!0))),t}function Qa(){W(2)}function mr(t){return Object.isFrozen(t)}var Kr={};function oe(t){const r=Kr[t];return r||W(0,t),r}function to(t,r){Kr[t]||(Kr[t]=r)}var Ze;function ui(){return Ze}function eo(t,r){return{drafts_:[],parent_:t,immer_:r,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function li(t,r){r&&(oe("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=r)}function Vr(t){qr(t),t.drafts_.forEach(ro),t.drafts_=null}function qr(t){t===Ze&&(Ze=t.parent_)}function di(t){return Ze=eo(Ze,t)}function ro(t){const r=t[dt];r.type_===0||r.type_===1?r.revoke_():r.revoked_=!0}function fi(t,r){r.unfinalizedDrafts_=r.drafts_.length;const e=r.drafts_[0];return t!==void 0&&t!==e?(e[dt].modified_&&(Vr(r),W(4)),$t(t)&&(t=gr(r,t),r.parent_||Ir(r,t)),r.patches_&&oe("Patches").generateReplacementPatches_(e[dt].base_,t,r.patches_,r.inversePatches_)):t=gr(r,e,[]),Vr(r),r.patches_&&r.patchListener_(r.patches_,r.inversePatches_),t!==Yr?t:void 0}function gr(t,r,e){if(mr(r))return r;const n=r[dt];if(!n)return Ke(r,(i,o)=>pi(t,n,r,i,o,e)),r;if(n.scope_!==t)return r;if(!n.modified_)return Ir(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let o=i,c=!1;n.type_===3&&(o=new Set(i),i.clear(),c=!0),Ke(o,(u,d)=>pi(t,n,i,u,d,e,c)),Ir(t,i,!1),e&&t.patches_&&oe("Patches").generatePatches_(n,e,t.patches_,t.inversePatches_)}return n.copy_}function pi(t,r,e,n,i,o,c){if(process.env.NODE_ENV!=="production"&&i===e&&W(5),se(i)){const u=o&&r&&r.type_!==3&&!Ve(r.assigned_,n)?o.concat(n):void 0,d=gr(t,i,u);if(ci(e,n,d),se(d))t.canAutoFreeze_=!1;else return}else c&&e.add(i);if($t(i)&&!mr(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;gr(t,i),(!r||!r.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(e,n)&&Ir(t,i)}}function Ir(t,r,e=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Xr(r,e)}function no(t,r){const e=Array.isArray(t),n={type_:e?1:0,scope_:r?r.scope_:ui(),modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,o=Jr;e&&(i=[n],o=Qe);const{revoke:c,proxy:u}=Proxy.revocable(i,o);return n.draft_=u,n.revoke_=c,u}var Jr={get(t,r){if(r===dt)return t;const e=ae(t);if(!Ve(e,r))return so(t,e,r);const n=e[r];return t.finalized_||!$t(n)?n:n===Zr(t.base_,r)?(tn(t),t.copy_[r]=en(n,t)):n},has(t,r){return r in ae(t)},ownKeys(t){return Reflect.ownKeys(ae(t))},set(t,r,e){const n=hi(ae(t),r);if(n!=null&&n.set)return n.set.call(t.draft_,e),!0;if(!t.modified_){const i=Zr(ae(t),r),o=i==null?void 0:i[dt];if(o&&o.base_===e)return t.copy_[r]=e,t.assigned_[r]=!1,!0;if(Za(e,i)&&(e!==void 0||Ve(t.base_,r)))return!0;tn(t),Qr(t)}return t.copy_[r]===e&&(e!==void 0||r in t.copy_)||Number.isNaN(e)&&Number.isNaN(t.copy_[r])||(t.copy_[r]=e,t.assigned_[r]=!0),!0},deleteProperty(t,r){return Zr(t.base_,r)!==void 0||r in t.base_?(t.assigned_[r]=!1,tn(t),Qr(t)):delete t.assigned_[r],t.copy_&&delete t.copy_[r],!0},getOwnPropertyDescriptor(t,r){const e=ae(t),n=Reflect.getOwnPropertyDescriptor(e,r);return n&&{writable:!0,configurable:t.type_!==1||r!=="length",enumerable:n.enumerable,value:e[r]}},defineProperty(){W(11)},getPrototypeOf(t){return ne(t.base_)},setPrototypeOf(){W(12)}},Qe={};Ke(Jr,(t,r)=>{Qe[t]=function(){return arguments[0]=arguments[0][0],r.apply(this,arguments)}}),Qe.deleteProperty=function(t,r){return process.env.NODE_ENV!=="production"&&isNaN(parseInt(r))&&W(13),Qe.set.call(this,t,r,void 0)},Qe.set=function(t,r,e){return process.env.NODE_ENV!=="production"&&r!=="length"&&isNaN(parseInt(r))&&W(14),Jr.set.call(this,t[0],r,e,t[0])};function Zr(t,r){const e=t[dt];return(e?ae(e):t)[r]}function so(t,r,e){var i;const n=hi(r,e);return n?"value"in n?n.value:(i=n.get)==null?void 0:i.call(t.draft_):void 0}function hi(t,r){if(!(r in t))return;let e=ne(t);for(;e;){const n=Object.getOwnPropertyDescriptor(e,r);if(n)return n;e=ne(e)}}function Qr(t){t.modified_||(t.modified_=!0,t.parent_&&Qr(t.parent_))}function tn(t){t.copy_||(t.copy_=Gr(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var io=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(r,e,n)=>{if(typeof r=="function"&&typeof e!="function"){const o=e;e=r;const c=this;return function(d=o,...h){return c.produce(d,m=>e.call(this,m,...h))}}typeof e!="function"&&W(6),n!==void 0&&typeof n!="function"&&W(7);let i;if($t(r)){const o=di(this),c=en(r,void 0);let u=!0;try{i=e(c),u=!1}finally{u?Vr(o):qr(o)}return li(o,n),fi(i,o)}else if(!r||typeof r!="object"){if(i=e(r),i===void 0&&(i=r),i===Yr&&(i=void 0),this.autoFreeze_&&Xr(i,!0),n){const o=[],c=[];oe("Patches").generateReplacementPatches_(r,i,o,c),n(o,c)}return i}else W(1,r)},this.produceWithPatches=(r,e)=>{if(typeof r=="function")return(c,...u)=>this.produceWithPatches(c,d=>r(d,...u));let n,i;return[this.produce(r,e,(c,u)=>{n=c,i=u}),n,i]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){$t(t)||W(8),se(t)&&(t=ao(t));const r=di(this),e=en(t,void 0);return e[dt].isManual_=!0,qr(r),e}finishDraft(t,r){const e=t&&t[dt];(!e||!e.isManual_)&&W(9);const{scope_:n}=e;return li(n,r),fi(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,r){let e;for(e=r.length-1;e>=0;e--){const i=r[e];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}e>-1&&(r=r.slice(e+1));const n=oe("Patches").applyPatches_;return se(t)?n(t,r):this.produce(t,i=>n(i,r))}};function en(t,r){const e=qe(t)?oe("MapSet").proxyMap_(t,r):Je(t)?oe("MapSet").proxySet_(t,r):no(t,r);return(r?r.scope_:ui()).drafts_.push(e),e}function ao(t){return se(t)||W(10,t),mi(t)}function mi(t){if(!$t(t)||mr(t))return t;const r=t[dt];let e;if(r){if(!r.modified_)return r.base_;r.finalized_=!0,e=Gr(t,r.scope_.immer_.useStrictShallowCopy_)}else e=Gr(t,!0);return Ke(e,(n,i)=>{ci(e,n,mi(i))}),r&&(r.finalized_=!1),e}function gi(){process.env.NODE_ENV!=="production"&&ai.push('Sets cannot have "replace" patches.',function(p){return"Unsupported patch operation: "+p},function(p){return"Cannot apply patch, path doesn't resolve: "+p},"Patching reserved attributes like __proto__, prototype and constructor is not allowed");const r="replace",e="add",n="remove";function i(p,k,b,y){switch(p.type_){case 0:case 2:return c(p,k,b,y);case 1:return o(p,k,b,y);case 3:return u(p,k,b,y)}}function o(p,k,b,y){let{base_:E,assigned_:f}=p,_=p.copy_;_.length<E.length&&([E,_]=[_,E],[b,y]=[y,b]);for(let w=0;w<E.length;w++)if(f[w]&&_[w]!==E[w]){const T=k.concat([w]);b.push({op:r,path:T,value:I(_[w])}),y.push({op:r,path:T,value:I(E[w])})}for(let w=E.length;w<_.length;w++){const T=k.concat([w]);b.push({op:e,path:T,value:I(_[w])})}for(let w=_.length-1;E.length<=w;--w){const T=k.concat([w]);y.push({op:n,path:T})}}function c(p,k,b,y){const{base_:E,copy_:f}=p;Ke(p.assigned_,(_,w)=>{const T=Wr(E,_),M=Wr(f,_),v=w?Ve(E,_)?r:e:n;if(T===M&&v===r)return;const A=k.concat(_);b.push(v===n?{op:v,path:A}:{op:v,path:A,value:M}),y.push(v===e?{op:n,path:A}:v===n?{op:e,path:A,value:I(T)}:{op:r,path:A,value:I(T)})})}function u(p,k,b,y){let{base_:E,copy_:f}=p,_=0;E.forEach(w=>{if(!f.has(w)){const T=k.concat([_]);b.push({op:n,path:T,value:w}),y.unshift({op:e,path:T,value:w})}_++}),_=0,f.forEach(w=>{if(!E.has(w)){const T=k.concat([_]);b.push({op:e,path:T,value:w}),y.unshift({op:n,path:T,value:w})}_++})}function d(p,k,b,y){b.push({op:r,path:[],value:k===Yr?void 0:k}),y.push({op:r,path:[],value:p})}function h(p,k){return k.forEach(b=>{const{path:y,op:E}=b;let f=p;for(let M=0;M<y.length-1;M++){const v=ie(f);let A=y[M];typeof A!="string"&&typeof A!="number"&&(A=""+A),(v===0||v===1)&&(A==="__proto__"||A==="constructor")&&W(19),typeof f=="function"&&A==="prototype"&&W(19),f=Wr(f,A),typeof f!="object"&&W(18,y.join("/"))}const _=ie(f),w=m(b.value),T=y[y.length-1];switch(E){case r:switch(_){case 2:return f.set(T,w);case 3:W(16);default:return f[T]=w}case e:switch(_){case 1:return T==="-"?f.push(w):f.splice(T,0,w);case 2:return f.set(T,w);case 3:return f.add(w);default:return f[T]=w}case n:switch(_){case 1:return f.splice(T,1);case 2:return f.delete(T);case 3:return f.delete(b.value);default:return delete f[T]}default:W(17,E)}}),p}function m(p){if(!$t(p))return p;if(Array.isArray(p))return p.map(m);if(qe(p))return new Map(Array.from(p.entries()).map(([b,y])=>[b,m(y)]));if(Je(p))return new Set(Array.from(p).map(m));const k=Object.create(ne(p));for(const b in p)k[b]=m(p[b]);return Ve(p,Xe)&&(k[Xe]=p[Xe]),k}function I(p){return se(p)?m(p):p}to("Patches",{applyPatches_:h,generatePatches_:i,generateReplacementPatches_:d})}var ft=new io,oo=ft.produce;ft.produceWithPatches.bind(ft),ft.setAutoFreeze.bind(ft),ft.setUseStrictShallowCopy.bind(ft);var co=ft.applyPatches.bind(ft);ft.createDraft.bind(ft),ft.finishDraft.bind(ft);var uo=9007199254740991,lo="[object Arguments]",fo="[object Function]",po="[object GeneratorFunction]",ho="[object Symbol]",mo=typeof ht=="object"&&ht&&ht.Object===Object&&ht,go=typeof self=="object"&&self&&self.Object===Object&&self,Io=mo||go||Function("return this")();function yo(t,r,e){switch(e.length){case 0:return t.call(r);case 1:return t.call(r,e[0]);case 2:return t.call(r,e[0],e[1]);case 3:return t.call(r,e[0],e[1],e[2])}return t.apply(r,e)}function bo(t,r){for(var e=-1,n=t?t.length:0,i=Array(n);++e<n;)i[e]=r(t[e],e,t);return i}function _o(t,r){for(var e=-1,n=r.length,i=t.length;++e<n;)t[i+e]=r[e];return t}var rn=Object.prototype,ko=rn.hasOwnProperty,nn=rn.toString,Ii=Io.Symbol,vo=rn.propertyIsEnumerable,yi=Ii?Ii.isConcatSpreadable:void 0,bi=Math.max;function So(t,r,e,n,i){var o=-1,c=t.length;for(e||(e=Ao),i||(i=[]);++o<c;){var u=t[o];e(u)?_o(i,u):i[i.length]=u}return i}function Eo(t,r){return t=Object(t),To(t,r,function(e,n){return n in t})}function To(t,r,e){for(var n=-1,i=r.length,o={};++n<i;){var c=r[n],u=t[c];e(u,c)&&(o[c]=u)}return o}function wo(t,r){return r=bi(r===void 0?t.length-1:r,0),function(){for(var e=arguments,n=-1,i=bi(e.length-r,0),o=Array(i);++n<i;)o[n]=e[r+n];n=-1;for(var c=Array(r+1);++n<r;)c[n]=e[n];return c[r]=o,yo(t,this,c)}}function Ao(t){return Do(t)||Oo(t)||!!(yi&&t&&t[yi])}function Mo(t){if(typeof t=="string"||zo(t))return t;var r=t+"";return r=="0"&&1/t==-1/0?"-0":r}function Oo(t){return Co(t)&&ko.call(t,"callee")&&(!vo.call(t,"callee")||nn.call(t)==lo)}var Do=Array.isArray;function Ro(t){return t!=null&&xo(t.length)&&!Po(t)}function Co(t){return _i(t)&&Ro(t)}function Po(t){var r=Lo(t)?nn.call(t):"";return r==fo||r==po}function xo(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=uo}function Lo(t){var r=typeof t;return!!t&&(r=="object"||r=="function")}function _i(t){return!!t&&typeof t=="object"}function zo(t){return typeof t=="symbol"||_i(t)&&nn.call(t)==ho}var No=wo(function(t,r){return t==null?{}:Eo(t,bo(So(r),Mo))}),Fo=No;const ki=Nr(Fo),$o={size:{width:1080,height:1920},fps:30,tracks:[],trackItemIds:[],trackItemsMap:{},transitionIds:[],transitionsMap:{},scale:{index:7,unit:300,zoom:1/300,segments:5},duration:0,activeIds:[],structure:[],background:{type:"color",value:"transparent"}},vi=["tracks","trackItemsMap","transitionIds","transitionsMap","trackItemIds","structure"];class Ho{constructor(r,e){Qt(this,"stateSubject");Qt(this,"stateHistorySubject");Qt(this,"prevState");Qt(this,"background");Qt(this,"undos",[]);Qt(this,"redos",[]);Qt(this,"listener");const n=Object.assign({},$o,r,e!=null&&e.scale?{scale:e.scale}:{});this.stateSubject=new Zn(n),this.stateHistorySubject=new Zn({handleRedo:!1,handleUndo:!1}),this.background=n.background,this.prevState=n,(e!=null&&e.cors||e!=null&&e.acceptsMap)&&ma({cors:e.cors,acceptsMap:e.acceptsMap}),this.initListeners()}initListeners(){Va(this)}destroyListeners(){this.listener&&this.listener.unsubscribe()}purge(){this.destroyListeners()}updateHistory(r,e){const n=ki(r,vi),i=ki(this.getState(),vi),o=ii(i,n);o.length&&(this.undos.push({undos:o,type:e}),this.redos=[])}getStateHistory(){return this.stateHistorySubject.getValue()}subscribeHistory(r){return this.stateHistorySubject.subscribe(r)}getState(){return this.stateSubject.getValue()}subscribe(r){return this.stateSubject.subscribe(r)}updateState(r,e={updateHistory:!1}){const n=this.getState(),i={...C(n),...C(r)};Y(n,i)||(e.updateHistory&&this.updateHistory(i,e.kind),this.prevState=n,this.stateSubject.next(i))}subscribeToUpdateStateDetails(r){return this.stateSubject.asObservable().subscribe(e=>{(!Y(e.size,this.prevState.size)||!Y(e.background,this.prevState.background))&&r({size:e.size,background:e.background})})}subscribeToScale(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.scale,this.prevState.scale)||r({scale:e.scale})})}subscribeToFps(r){return this.stateSubject.asObservable().subscribe(e=>{e.fps!==this.prevState.fps&&r({fps:e.fps})})}subscribeToUpdateTrackItem(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.trackItemsMap,this.prevState.trackItemsMap)||r({trackItemsMap:e.trackItemsMap})})}subscribeToUpdateAnimations(r){return this.stateSubject.asObservable().subscribe(e=>{const n=Object.keys(e.trackItemsMap).filter(i=>{const o=this.prevState.trackItemsMap[i],c=e.trackItemsMap[i];return o&&c&&!Y(o.animations,c.animations)});r({trackItemsMap:e.trackItemsMap,changedAnimationIds:n})})}subscribeToUpdateTrackItemTiming(r){return this.stateSubject.asObservable().subscribe(e=>{if(!Y(e.trackItemsMap,this.prevState.trackItemsMap)){const n=Object.keys(e.trackItemsMap).filter(o=>{const c=this.prevState.trackItemsMap[o],u=e.trackItemsMap[o];return c&&u&&!Y(c.trim,u.trim)}),i=Object.keys(e.trackItemsMap).filter(o=>{const c=this.prevState.trackItemsMap[o],u=e.trackItemsMap[o];return c&&u&&!Y(c.display,u.display)});r({trackItemsMap:e.trackItemsMap,changedTrimIds:n.length>0?n:void 0,changedDisplayIds:i.length>0?i:void 0})}})}subscribeToUpdateItemDetails(r){return this.stateSubject.asObservable().subscribe(e=>{Object.keys(e.trackItemsMap).some(i=>{const o=this.prevState.trackItemsMap[i],c=e.trackItemsMap[i];return o&&c&&!Y(o.details,c.details)})&&r({trackItemsMap:e.trackItemsMap})})}subscribeToDuration(r){return this.stateSubject.asObservable().subscribe(e=>{e.duration!==this.prevState.duration&&r({duration:e.duration})})}subscribeToHistory(r){return this.stateHistorySubject.asObservable().subscribe(e=>{if(e.handleRedo){const n=this.undos[this.undos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}if(e.handleUndo){const n=this.redos[this.redos.length-1].type;r({...this.getState(),type:n}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!1})}})}subscribeToAddOrRemoveItems(r){return this.stateSubject.asObservable().subscribe(e=>{const n=[...e.trackItemIds].sort(),i=[...this.prevState.trackItemIds].sort(),o=[...e.transitionIds].sort(),c=[...this.prevState.transitionIds].sort();(!Y(n,i)||!Y(o,c))&&r({trackItemIds:e.trackItemIds})})}subscribeToActiveIds(r){return this.stateSubject.asObservable().subscribe(e=>{Y(e.activeIds,this.prevState.activeIds)||r({activeIds:e.activeIds})})}subscribeToTracks(r){return this.stateSubject.asObservable().subscribe(e=>{const n=e.tracks,o=this.prevState.tracks.map(u=>u.id),c=n.filter(u=>!o.includes(u.id));c.length&&r({tracks:e.tracks,changedTracks:c.map(u=>u.id)})})}subscribeToState(r){return this.stateSubject.asObservable().subscribe(e=>{(!Y(e.tracks,this.prevState.tracks)||!Y(e.trackItemIds,this.prevState.trackItemIds)||!Y(e.trackItemsMap,this.prevState.trackItemsMap)||!Y(e.transitionIds,this.prevState.transitionIds)||!Y(e.transitionsMap,this.prevState.transitionsMap)||!Y(e.structure,this.prevState.structure))&&r({tracks:e.tracks,trackItemIds:e.trackItemIds,trackItemsMap:e.trackItemsMap,transitionIds:e.transitionIds,transitionsMap:e.transitionsMap,structure:e.structure})})}undo(){const r=this.undos.pop(),e=r==null?void 0:r.undos,n=r==null?void 0:r.type;if(!e||!n)return;gi();const{trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:d,structure:h}=this.getState(),m=C({trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:d,structure:h}),I=[],p=[],k=[],b=[],y=[],E=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"remove",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.oldValue}:F={path:nt,op:"add",value:D.oldValue},D.path.includes("trackItemIds")?k.push(F):D.path.includes("transitionIds")?p.push(F):D.path.includes("trackItemsMap")?y.push(F):D.path.includes("transitionsMap")?b.push(F):D.path.includes("tracks")?I.push(F):D.path.includes("structure")&&E.push(F)});const f=this.applyPatch(m.tracks,I),_=this.applyPatch(m.transitionIds,p),w=this.applyPatch(m.trackItemIds,k),T=this.applyPatch(m.transitionsMap,b),M=this.applyPatch(m.trackItemsMap,y),v=this.applyPatch(m.structure,E),A=C({tracks:f,transitionIds:_,trackItemIds:w,transitionsMap:T,trackItemsMap:M,structure:v}),U=C(this.getState()),P={...U,...A};this.prevState=U,this.redos.push({redos:e,type:n});const K=X(P.trackItemsMap);this.stateSubject.next({...P,duration:K}),this.stateHistorySubject.next({handleRedo:!1,handleUndo:!0}),this.updateState(P,{updateHistory:!1})}applyPatch(r,e){return e.reverse().reduce((n,i)=>oo(n,o=>{co(o,[i])}),r)}redo(){const r=this.redos.pop(),e=r==null?void 0:r.redos,n=r==null?void 0:r.type;if(!e||!n)return;gi();const{trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:d,structure:h}=this.getState(),m=C({trackItemIds:i,tracks:o,transitionIds:c,transitionsMap:u,trackItemsMap:d,structure:h}),I=[],p=[],k=[],b=[],y=[],E=[];e.forEach(D=>{let F;const nt=D.path.slice(1);D.type==="CREATE"?F={path:nt,op:"add",value:D.value}:D.type==="CHANGE"?F={path:nt,op:"replace",value:D.value}:F={path:nt,op:"remove",value:D.oldValue},D.path.includes("trackItemIds")?k.push(F):D.path.includes("transitionIds")?p.push(F):D.path.includes("trackItemsMap")?y.push(F):D.path.includes("transitionsMap")?b.push(F):D.path.includes("structure")?E.push(F):I.push(F)});const f=this.applyPatch(m.tracks,I),_=this.applyPatch(m.transitionIds,p),w=this.applyPatch(m.trackItemIds,k),T=this.applyPatch(m.transitionsMap,b),M=this.applyPatch(m.trackItemsMap,y),v=this.applyPatch(m.structure,E),A=C({tracks:f,transitionIds:_,trackItemIds:w,transitionsMap:T,trackItemsMap:M,structure:v}),U=C(this.getState()),P={...U,...A};this.prevState=U,this.undos.push({undos:e,type:n});const K=X(P.trackItemsMap);this.stateSubject.next({...P,duration:K}),this.stateHistorySubject.next({handleRedo:!0,handleUndo:!1}),this.updateState(P,{updateHistory:!1})}toJSON(){const{fps:r,tracks:e,size:n,trackItemIds:i,transitionsMap:o,trackItemsMap:c,transitionIds:u}=this.getState();return{fps:r,tracks:e,size:n,trackItemIds:i,transitionsMap:o,trackItemsMap:c,transitionIds:u}}}S.ACTIVE_CLONE=Ji,S.ACTIVE_DELETE=qi,S.ACTIVE_PASTE=As,S.ACTIVE_PREFIX=te,S.ACTIVE_SET=Vi,S.ACTIVE_SPLIT=Ms,S.ADD_ANIMATION=ds,S.ADD_AUDIO=os,S.ADD_CAPTIONS=fs,S.ADD_COMPOSITION=ms,S.ADD_HILL_AUDIO_BARS=vs,S.ADD_ILLUSTRATION=us,S.ADD_IMAGE=cs,S.ADD_ITEMS=hs,S.ADD_LINEAL_AUDIO_BARS=bs,S.ADD_MASK=Bi,S.ADD_PLACEHOLDER=Ui,S.ADD_PREFIX=B,S.ADD_PROGRESS_BAR=gs,S.ADD_PROGRESS_FRAME=Is,S.ADD_PROGRESS_SQUARE=_s,S.ADD_RADIAL_AUDIO_BARS=ys,S.ADD_RECT=Ss,S.ADD_SHAPE=ls,S.ADD_SUFFIX=Ni,S.ADD_TEMPLATE=ps,S.ADD_TEXT=is,S.ADD_TRANSITION=ji,S.ADD_VIDEO=as,S.ADD_WAVE_AUDIO_BARS=ks,S.BULK_PREFIX=rs,S.DELETE_TEMPLATE_ITEM=Xi,S.DESIGN_LOAD=ns,S.DESIGN_PREFIX=fr,S.DESIGN_RESIZE=ss,S.EDIT_BACKGROUND_EDITOR=ws,S.EDIT_BULK=Fr,S.EDIT_OBJECT=Es,S.EDIT_PREFIX=At,S.EDIT_SHAPE=Wi,S.EDIT_TEMPLATE_ITEM=Gi,S.EDIT_TEXT=Yi,S.ENTER_EDIT_MODE=Ki,S.HISTORY_PREFIX=Ye,S.HISTORY_REDO=Ls,S.HISTORY_RESET=ca,S.HISTORY_UNDO=xs,S.LAYER_CLONE=Rs,S.LAYER_COPY=Ds,S.LAYER_CUT=oa,S.LAYER_DELETE=Cs,S.LAYER_EDITING_NAME=sa,S.LAYER_HIDDEN=Qi,S.LAYER_LOCKED=Zi,S.LAYER_MOVE=ta,S.LAYER_PASTE=ia,S.LAYER_PREFIX=V,S.LAYER_RENAME=na,S.LAYER_REPLACE=Ps,S.LAYER_SELECT=Os,S.LAYER_SELECTION=ea,S.LAYER_SEND_TO=ra,S.LAYER_SPLIT=aa,S.REPLACE_MEDIA=Ts,S.STATE_CHANGED=Hi,S.STATE_PREFIX=es,S.TIMELINE_SCALE_CHANGED=zs,S.TIMELINE_SCALE_PREFIX=$r,S.TRACKS_CHANGED=Fi,S.TRACK_ITEMS_CHANGED=$i,S.TRACK_ITEMS_PREFIX=ts,S.TRACK_PREFIX=Qn,S.default=Ho,S.getAcceptsMap=Hs,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
